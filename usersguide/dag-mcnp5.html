

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Monte Carlo Code-Specific Steps for DAG-MCNP5 &mdash; DAGMC</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="DAGMC" href="../index.html" />
    <link rel="up" title="DAGMC User’s Guide" href="index.html" />
    <link rel="next" title="Monte Carlo Code-Specific Steps for DAG-Tripoli4" href="dag-tripoli4.html" />
    <link rel="prev" title="Using DAGMC - The DAGMC Workflow" href="workflow.html" /> 
  </head>
  <body> 
<div id="page-div" class="page">
<div id="header"><a id="uwhome" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/wordmark.gif" alt="University of Wisconsin–Madison" width="260" height="11" /></a> <a id="crest" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/crest.png" alt="" width="70" height="106" /></a>
    <h1 id="siteTitle"><a href="/"><span>DAGMC</span></a></h1>
    <div id="tagline"><span>Direct Accelerated Geometry Monte Carlo Toolkit</span></div>
    <ul id="globalnav">
      <li id="uwsearch"><a href="http://www.wisc.edu/search/">UW Search</a></li>
      <li><a href="http://cnerg.github.com">CNERG</a></li>
      <li><a href="http://my.wisc.edu">My UW</a></li>
      <li><a href="http://map.wisc.edu">Map</a></li>
      <li id="last_tool"><a href="http://www.today.wisc.edu">Calendar</a></li>
    </ul>
    <form role="search" action="../search.html" method="get" id="cse-search-box">
      <div>
      <label class="screen-reader-text" for="q">Search for:</label>
      <input type="text" id="q" name="q" value="Enter keywords here...." />
      <input type="submit" id="sa" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </div>
    </form>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

    <div id="nav" class="main-menu-container">
      <ul id="menu-main" class="sf-menu">
        <li class="menu-item"><a href="../index.html">DAGMC</a></li>
        <li class="menu-item" style="margin-right: 10px">
          <a href="workflow.html" title="Using DAGMC - The DAGMC Workflow"
             accesskey="P">previous</a>
          </li>
        <li class="menu-item" >
          <a href="dag-tripoli4.html" title="Monte Carlo Code-Specific Steps for DAG-Tripoli4"
             accesskey="N">next</a>
          </li>
        <li class="menu-item" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
          </li>
          <li class="menu-item"><a href="index.html" accesskey="U">DAGMC User&#8217;s Guide</a></li> 
      </ul>
    </div>
  <div id="c_container"> 
<div id="sidebar">
 <div id="sidebar_section"></div>
 <div id="sidebar_section"><strong>Table of Contents</strong><br><ul>
<li><a class="reference internal" href="#">Monte Carlo Code-Specific Steps for DAG-MCNP5</a><ul>
<li><a class="reference internal" href="#geometry-metadata">Geometry Metadata</a><ul>
<li><a class="reference internal" href="#assigning-materials-densities">Assigning Materials &amp; Densities</a></li>
<li><a class="reference internal" href="#defining-boundary-conditions">Defining Boundary Conditions</a></li>
<li><a class="reference internal" href="#tally-assignments">Tally Assignments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preparing-the-dag-mcnp5-input-file">Preparing the DAG-MCNP5 Input File</a></li>
<li><a class="reference internal" href="#running-dag-mcnp5">Running DAG-MCNP5</a></li>
</ul>
</li>
</ul>
 </div>
</div> 
    <div id="content" class="inline-block">
          <div class="post">
            
  <div class="section" id="monte-carlo-code-specific-steps-for-dag-mcnp5">
<h1>Monte Carlo Code-Specific Steps for DAG-MCNP5<a class="headerlink" href="#monte-carlo-code-specific-steps-for-dag-mcnp5" title="Permalink to this headline">¶</a></h1>
<p>There are three varieties of code-specific steps:</p>
<ol class="arabic simple">
<li>defining attributes of the geometry using groups in CUBIT</li>
<li>defining DAGMC runtime parameters using input file syntax</li>
<li>changes to the command-line</li>
</ol>
<div class="section" id="geometry-metadata">
<h2>Geometry Metadata<a class="headerlink" href="#geometry-metadata" title="Permalink to this headline">¶</a></h2>
<p>In DAG-MCNP5, the geometry file can be used to define material and
density assignments, boundary conditions, and tally locations.</p>
<div class="section" id="assigning-materials-densities">
<h3>Assigning Materials &amp; Densities<a class="headerlink" href="#assigning-materials-densities" title="Permalink to this headline">¶</a></h3>
<p>The generic workflow description includes details on
<a class="reference internal" href="workflow.html#grouping-basics"><em>Grouping Volumes and Surfaces</em></a> , but a specific naming convention is required
for DAG-MCNP5. To define materials, both the MCNP material ID and
density must be provided in the group name. The format for the group
name is as follows: :: mat_[matid]_rho_[density]</p>
<p><tt class="docutils literal"><span class="pre">[matid]</span></tt> is replaced by the material ID that will be specified in
the MCNP input file.  <tt class="docutils literal"><span class="pre">[density]</span></tt> is replaced by either the atomic
density or the mass density.  Like the MCNP cell cards, positive
values are atomic densities in [atoms/barn-cm] and negative values are
mass densities in [g/cc].</p>
<p>For example, suppose UO2 is material 7 in the problem, has an atomic
density of 0.0223 and volumes 4 through 18 consist of this material.
To assign materials to these volumes, the following command would be
used:</p>
<div class="highlight-python"><pre>group "mat_7_rho_0.0223" add vol 4 to 18</pre>
</div>
<p><em>Note: If a volume is not assigned to a specific group, when run in
DAGMC it will be treated as a void; the material for that cell will
be zero. This can actually become a fairly useful debugging tool to
identify volumes that were not assigned to their appropriate group.</em></p>
<p>If you would like to assign a material to the explicit complement, you
can use the same mechanism, but add the string <tt class="docutils literal"><span class="pre">_comp</span></tt> to the end of
the group name.  Since DAGMC only recognizes those groups that contain
an entity, it is necessary to add a volume to this group, recognizing
that this material will NOT be assigned to that volume.  (<em>It is often
convenient to assign the graveyard volume (see below) to the implicit
complement material group to minimize confusion.</em>) For example, if you
would like the explicit complement to be modeled as material 9 with
density 1 g/cc:</p>
<div class="highlight-python"><pre>create group "mat_9_rho_-1_comp"</pre>
</div>
</div>
<div class="section" id="defining-boundary-conditions">
<h3>Defining Boundary Conditions<a class="headerlink" href="#defining-boundary-conditions" title="Permalink to this headline">¶</a></h3>
<p>There are two general classes of boundary condition supported by
DAG-MCNP5. a vacuum boundary and reflecting surfaces, and they are
implemented in different ways.</p>
<ul class="simple">
<li><strong>Defining the &#8220;graveyard&#8221;: vacuum boundaries</strong></li>
</ul>
<p>A typical usage of MCNP5 includes a volume that extends to infinity
with an importance of 0 that bounds the active volumes of interest.
Since solid models cannot include any infinite volumes, it is
necessary to place a finite volume of importance 0 to define the
problem boundary. You will need to surround the entire geometry with a
shell of finite thickness, known as the &#8220;graveyard&#8221;.  Any geometric
shape can be used for this; however, a cubic shell is preferred.  This
shell volume will represent the outside world and will be the cell
where all of the particles are terminated (thus it will have an
importance of zero).</p>
<p>To create this volume create two volumes in CUBIT with the same shape,
same center, and one slightly larger than the other.  Subtract the
smaller from the larger.  The remaining volume is the graveyard.</p>
<p>Like the material definitions and boundary conditions discussed in the
previous section. The graveyard is defined by assigning it a specific
group name, one of the following keywords:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">graveyard</span>
<span class="n">outside</span><span class="o">.</span><span class="n">world</span>
<span class="n">rest</span><span class="o">.</span><span class="n">of</span><span class="o">.</span><span class="n">world</span>
</pre></div>
</div>
<p>Consider a geometry with 99 volumes that all fit within a cube
centered at the origin with side-length 99 cm.  To create a graveyard
for this problem in CUBIT, you could issue the following commands:</p>
<div class="highlight-python"><pre>cubit_prompt&gt; create brick x 100
cubit_prompt&gt; create brick x 105
cubit_prompt&gt; subtract vol 100 from vol 101
cubit_prompt&gt; group "graveyard" add vol 102</pre>
</div>
<p>When DAG-MCNP5 is run, the importance of volume 102 (or any other
volumes included in the group) will be set to zero. (_Note: this
assumes that the two <tt class="docutils literal"><span class="pre">create</span> <span class="pre">brick</span></tt> commands generate volumes
numbered 100 and 101, respectively, and that the Boolean subtraction
results in a new volume number 102.</p>
<p>If you have boundary conditions (reflecting, white, or periodic) it is
not required that you surround them with the bounding volume, but is
not incorrect to do so.  Only areas where particles should escape need
to be enclosed.  However, it is often easiest to simply create a
single graveyard that covers all directions and volumes of the system.</p>
<ul class="simple">
<li><strong>Surface boundary conditions: reflection</strong></li>
</ul>
<p>Surface boundary conditions are similarly enforced by specifying a
group name. This type of attribute (surface boundary condition) is
only required if reflective or white boundary conditions are used in
the problem.  If not, this section may be skipped.  <em>Note that
periodic boundary conditions are not yet supported.</em></p>
<p>Specifying reflecting and white boundary conditions are fairly
straightforward.  The group names for reflecting and white are
respectively:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">spec</span><span class="o">.</span><span class="n">reflect</span>
<span class="n">white</span><span class="o">.</span><span class="n">reflect</span>
</pre></div>
</div>
<p>Suppose surfaces 10 and 11 are reflecting boundary conditions.  To
specify these as reflecting surfaces, the following group would be
created:</p>
<div class="highlight-python"><pre>group "spec.reflect" add surf 10 11</pre>
</div>
</div>
<div class="section" id="tally-assignments">
<h3>Tally Assignments<a class="headerlink" href="#tally-assignments" title="Permalink to this headline">¶</a></h3>
<p>It is also possible, although not required, to specify tallies in the
geometry.  The general form for adding this meta-data is to create a
group of volumes or surfaces and encode the meta-data in the names of
those groups.</p>
<p>The user has the option of specifying tallies in the geometry
directly.  It is still possible to specify tallies in the MCNP input
file, however, the user has to make sure that the tally indices are
not duplicated lest a fatal error will occur.  Tallies are specified
as group names in the following format:</p>
<div class="highlight-python"><pre>tally_[CUBIT tally ID].[tally type keyword].[particles]</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">[CUBIT</span> <span class="pre">tally</span> <span class="pre">ID]</span></tt> field is an integer from 0 to 99.  Different
tally types may have the same CUBIT ID and are still consistent.  The
tally number in MCNP is 10 times the CUBIT ID plus the tally type
index (e.g. 4 for cell flux tallies).</p>
<p>The <tt class="docutils literal"><span class="pre">[tally</span> <span class="pre">type</span> <span class="pre">keyword]</span></tt> is one of the following for each type of
tally:</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Tally Type</td>
<td>tally type keyword</td>
</tr>
<tr class="row-even"><td>f1</td>
<td>surf.current</td>
</tr>
<tr class="row-odd"><td>f2</td>
<td>surf.flux</td>
</tr>
<tr class="row-even"><td>f4</td>
<td>cell.flux</td>
</tr>
<tr class="row-odd"><td>f6</td>
<td>cell.heating</td>
</tr>
<tr class="row-even"><td>f7</td>
<td>cell.fission</td>
</tr>
<tr class="row-odd"><td>f8</td>
<td>pulse.height</td>
</tr>
</tbody>
</table>
<p>Also *tallies (the tally result times the incident particle energy)
are possible by placing an &#8220;e&#8221; before the tally type.  So to make a
*f2 tally, the keyword would be <tt class="docutils literal"><span class="pre">esurf_flux</span></tt>.  Pulse height (f8) tallies
have the option to include charge as well.  This is done by placing a
&#8220;q&#8221; before the keyword as in <tt class="docutils literal"><span class="pre">qpulse_height</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">[particles]</span></tt> tag is a string stating which particles will be
tallied.  To tally both photons and neutrons, set the tag to &#8220;np&#8221;.
The default is neutrons only.  Should this be tag be omitted, only
neutrons will be tallied.</p>
<p>Some CUBIT commands to do tallies:</p>
<div class="highlight-python"><pre>group "tally_0.surf.current" add surf 1 to 4
group "tally_0.cell.flux.p" add vol 7
group "tally_1.ecell.heating.np" add vol 2 6
group "tally_6.cell.heating.n" add vol 2 6
group "tally_7.cell.flux.p" add vol 1 to 3
group "tally_12.pulse.height.p" add vol 10 to 14
group "tally_14.qpulse.height.p" add vol 10 to 14</pre>
</div>
<p>The above are equivalent to following MCNP definitions:</p>
<div class="highlight-python"><pre>f1:n 1 2 3 4 T
f4:p 7 T
*f16:n,p 2 6 T
f66:n 2 6 T
f74:p 1 2 3 T
f128:p 10 11 12 13 14 T
+f148:p 10 11 12 13 14 T</pre>
</div>
<p><em>(Note: the current convention is to always add a tally bin for the
total across all cells/volumes.)</em></p>
</div>
</div>
<div class="section" id="preparing-the-dag-mcnp5-input-file">
<h2>Preparing the DAG-MCNP5 Input File<a class="headerlink" href="#preparing-the-dag-mcnp5-input-file" title="Permalink to this headline">¶</a></h2>
<p>The DAG-MCNP5 input file contains only the data cards section of a
standard MCNP5 input file.  There are no cell or surface cards
included in the input file.</p>
<p>In addition to many other MCNP5 data cards, it is important to define
the materials that have been assigned in step 2.D.i.a above and any
tally modifiers, as desired, for the tallies defined in step 2.D.i.a
above.</p>
<p>A new data card has been added to DAG-MCNP5 to define parameters for
the DAGMC geometry capability.  These parameters are described in
<a class="reference internal" href="workflow.html#additional-parameters"><em>Additional Input Parameters for DAGMC</em></a>.</p>
<div class="highlight-python"><pre>Form: dagmc  keyword1=value   keyword2=value
       check_src_cell: behavior of CEL variable in SDEF card
                       on  [default] standard interpretation for
                                     CEL variable: source rejection
                       off           no cell rejection - assume that
                                     sampled position is in cell CEL
    overlap_thickness: allows particle tracking through small overlaps
                       {real} [default=0.0]
               usecad: toggle usage of solid model geometry
                       off [default] ray-tracing limited to facets
                       on            ray-tracing performed on solid model
                                     geometry surfaces
            distlimit: toggle usage of flight distance sampled from
                       physics to accelerate ray-tracing search
                       off [default] do not use physics flight distance
                       on            do use physics flight distance</pre>
</div>
</div>
<div class="section" id="running-dag-mcnp5">
<h2>Running DAG-MCNP5<a class="headerlink" href="#running-dag-mcnp5" title="Permalink to this headline">¶</a></h2>
<p>Running DAG-MCNP5 is identical to running the standard MCNP5, but a
few new keywords have been added to the command-line to specify the
necessary files.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2"><tt class="docutils literal"><span class="pre">gcad=&lt;geom_file&gt;</span></tt>:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body">(required) The <tt class="docutils literal"><span class="pre">geom_file</span></tt> is the geometry
file that contains your geometric model, either
in the ACIS (*.sat) format or the MOAB (*.h5m)
format.  If this entry is not present,
DAG-MCNP5 will assume that it is running in
standard MCNP5 mode.  This runtime parameter is
described in more detail above.</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2"><tt class="docutils literal"><span class="pre">ftol=&lt;faceting_tolerance&gt;</span></tt>:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body">(optional) [default: 1e-3] This is a
real number that provides guidance to
the faceting engine regarding the
maximum distance between a facet and
the surface it is representing.  It is
only used when reading an ACIS (*.sat)
<tt class="docutils literal"><span class="pre">geom_file</span></tt>.  When reading a MOAB
(*.h5m) file, the facets have already
been generated and this setting is
ignored.  This runtime parameter is
described in more detail above.</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2"><a href="#id1"><span class="problematic" id="id2">``</span></a>fcad=&lt;facet_file&gt;:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body">(optional) The <tt class="docutils literal"><span class="pre">facet_file</span></tt> is written by
DAG-MCNP5 in the MOAB (*.h5m) format.  When
an ACIS file is read by DAG-MCNP5, a number
of pre-processing and initialization steps
are necessary.  Since these can be time
consuming, the user has the option to
create a <tt class="docutils literal"><span class="pre">facet_file</span></tt> the first time that
they use a geometry and then use that
<tt class="docutils literal"><span class="pre">facet_file</span></tt> with the <tt class="docutils literal"><span class="pre">gcad</span></tt> keyword in
subsequent uses.  This runtime parameter is
described in more detail above.</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2"><tt class="docutils literal"><span class="pre">lcad=&lt;log_file&gt;</span></tt>:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body">(optional) The <tt class="docutils literal"><span class="pre">log_file</span></tt> is a skeleton of an
MCNP file for the cells and surfaces in
your geometry.  This file is created by
DAG-MCNP5 to communicate the material
assignments, boundary conditions, and
tallies that you defined in your geometry.
If you give a name other than the default
(<tt class="docutils literal"><span class="pre">lcad</span></tt>) for this file on the command-line,
that file will be used instead of the one
generated automatically by DAG-MCNP5.  This
is useful to make small changes to your
material assignments and/or importances,
but <strong>can not</strong> be used to change the
geometry.  It is up to the user to ensure
that the <tt class="docutils literal"><span class="pre">log_file</span></tt> being used
corresponds to the geometry file in
question.  This runtime parameter is unique
to the DAG-MCNP5 implementation of DAGMC.</td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
      </div>

    </div>
</div>
    <div id="footer">
      <p>
        &copy; Copyright 2012-2013, The UW CNERG Team.
      </p>
      <p>
      Last updated on Aug 11, 2013.
      </p>
      <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
      </p>
    </div>
  </body>
</html>