
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DAGMC Tools &mdash; DAGMC</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="DAGMC" href="../index.html" />
    <link rel="next" title="DAGMC Developers Guide" href="../devguide/index.html" />
    <link rel="prev" title="Frequently Asked Questions" href="../usersguide/faq.html" /> 
  </head>
  <body> 
<div id="page-div" class="page">
<div id="header"><a id="uwhome" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/wordmark.gif" alt="University of Wisconsin–Madison" width="260" height="11" /></a> <a id="crest" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/crest.png" alt="" width="70" height="106" /></a>
    <h1 id="siteTitle"><a href="/"><span>DAGMC</span></a></h1>
    <div id="tagline"><span>Direct Accelerated Geometry Monte Carlo Toolkit</span></div>
    <ul id="globalnav">
      <li id="uwsearch"><a href="http://www.wisc.edu/search/">UW Search</a></li>
      <li><a href="http://cnerg.github.com">CNERG</a></li>
      <li><a href="http://my.wisc.edu">My UW</a></li>
      <li><a href="http://map.wisc.edu">Map</a></li>
      <li id="last_tool"><a href="http://www.today.wisc.edu">Calendar</a></li>
    </ul>
    <form role="search" action="../search.html" method="get" id="cse-search-box">
      <div>
      <label class="screen-reader-text" for="q">Search for:</label>
      <input type="text" id="q" name="q" value="Enter keywords here...." />
      <input type="submit" id="sa" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </div>
    </form>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

    <div id="nav" class="main-menu-container">
      <ul id="menu-main" class="sf-menu">
        <li class="menu-item"><a href="../index.html">DAGMC</a></li>
        <li class="menu-item" style="margin-right: 10px">
          <a href="../usersguide/faq.html" title="Frequently Asked Questions"
             accesskey="P">previous</a>
          </li>
        <li class="menu-item" >
          <a href="../devguide/index.html" title="DAGMC Developers Guide"
             accesskey="N">next</a>
          </li>
        <li class="menu-item" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
          </li> 
      </ul>
    </div>
  <div id="c_container"> 
<div id="sidebar">
 <div id="sidebar_section"></div>
 <div id="sidebar_section"><strong>Table of Contents</strong><br><ul>
<li><a class="reference internal" href="#">DAGMC Tools</a><ul>
<li><a class="reference internal" href="#mcnp2cad">mcnp2cad</a></li>
<li><a class="reference internal" href="#dagmc-prepoc">dagmc_prepoc</a></li>
<li><a class="reference internal" href="#mbconvert">mbconvert</a></li>
<li><a class="reference internal" href="#make-watertight">make_watertight</a></li>
<li><a class="reference internal" href="#mklostvis">mklostvis</a></li>
</ul>
</li>
</ul>
 </div>
</div> 
    <div id="content" class="inline-block">
          <div class="post">
            
  <div class="section" id="dagmc-tools">
<h1>DAGMC Tools<a class="headerlink" href="#dagmc-tools" title="Permalink to this headline">¶</a></h1>
<p>The DAGMC infrastructure has a number of tools that are used to process, fix, diagnose and repair
processed models. This document serves to better inform and
educate what those tools are and how to use them.</p>
<div class="section" id="mcnp2cad">
<h2>mcnp2cad<a class="headerlink" href="#mcnp2cad" title="Permalink to this headline">¶</a></h2>
<p>UW has a tool, <a class="reference external" href="https://github.com/svalinn/mcnp2cad">mcnp2cad</a>, which can translate a MCNP model
into ACIS format for use in future DAGMC simulations. The tool builds CAD solids from MCNP cell descriptions
often turning infinite bodies and planes into finite versions. At the time of writing, the only unsupported
MCNP surface descriptions are limited to GQ&#8217;s and SQ&#8217;s. To run mcnp2cad all that is needed is an MCNP input deck,</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; mcnp2cad test.inp
</pre></div>
</div>
<p>Will result in a file called out.sat which will contain the CAD version of your MCNP input. Furthermore, mcnp2cad
automatically transfers material and importance assignments into the CAD model and will be translated to the
DAGMC file when processed.</p>
</div>
<div class="section" id="dagmc-prepoc">
<h2>dagmc_prepoc<a class="headerlink" href="#dagmc-prepoc" title="Permalink to this headline">¶</a></h2>
<p>Previously it was typical of DAGMC users to input the ACIS file directly into DAGMC, the file would
be faceted and then immediately loaded into memory however, as models have grown in complexity, the time
required to facet and build the OBB tree has grown immensely and it is now recommended that faceting is
treated as a preprocess step.</p>
<p>When MOAB is built with CGM support (see <a class="reference external" href="get_install.html">build instructions</a>) the tool
dagmc_preproc is automatically built. You can confirm that you have MOAB in your path and that
the executable is built, by running</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; which dagmc_preproc
</pre></div>
</div>
<p>To which you should get a reply like</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; /data/opt/$USER/moab/bin/dagmc_preproc
</pre></div>
</div>
<p>If you get a reply like above then you are able to use dagmc_preproc. If not, and the MOAB <cite>bin</cite> directory is not in your <cite>$PATH</cite>
, you need to recompile with MOAB support following the build instructions. Once the model is in the correct form as required
by our <a class="reference external" href="workflow.html">workflow</a> dagmc_preproc may be used. The dagmc_prepoc tool is invoked by,</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; dagmc_preproc &lt;filename.sat&gt; -o &lt;output_filename.h5m&gt; [options]
</pre></div>
</div>
<p>There are several options that are commonly used by dagmc_preproc to control the state of the output file.</p>
<div class="highlight-python"><div class="highlight"><pre>-f &lt;float&gt; - the facet distance tolerance to be used,
             i.e. the maximum distance (cm) the facet
             may lie from the curve
-l &lt;float&gt; - the facet length tolerance to be used,
             i.e. the maximum length of the side of
             the facet (cm)
-a &lt;int&gt; - the angle tolerance to be used, i.e.
            the maximum angle that the facet can
             deviate from the surface normal
-o &lt;char&gt; - the name of the output facet file to create
--fatal_curves - fatal error when finding curves that cannot be faceted
-h - print help
</pre></div>
</div>
<p>For example, to facet a file called geom.sat into a file called facet_file.h5m with a facet tolerance of 1e-4 cm:</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; dagmc_preproc geom.sat -f 1.0e-4 -o facet_file.h5m
</pre></div>
</div>
<p>This file can then be used by DAGMC, MOAB and other down stream tools.</p>
</div>
<div class="section" id="mbconvert">
<h2>mbconvert<a class="headerlink" href="#mbconvert" title="Permalink to this headline">¶</a></h2>
<p>The mbconvert tool from the MOAB tool is used to translate MOAB meshes into some text based format. It is useful for converting
DAGMC models into some other visualization form for result post processing, such as stl files for viewing in Visit or Paraview. To
run mbconvert input option, input filename and output filename are specificed:</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; mbconvert &lt;input_filename&gt; &lt;output_filename&gt; [options]
</pre></div>
</div>
<p>The options which control mbconvert are:</p>
<div class="highlight-python"><div class="highlight"><pre>-v  &lt;int&gt; - extract a specific volume or range of volumes
-s  &lt;int&gt; - extract a specific surface or range of surfaces
-c  &lt;int&gt; - extract a specific curve or range of curves
-1  - extract edges only
-2  - extract two dimensional entites only e.g. Tri, Quad, etc.
-3  - extract three dimensional entities only, e.g. tet, hex, etc.
-h  - print help
</pre></div>
</div>
<p>To use mbconvert one must already have a DAGMC h5m file ready to use, the following command will convert the file to an stl file</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; mbconvert &lt;dagmc.h5m&gt; &lt;dagmc.stl&gt;
</pre></div>
</div>
<p>It is often the case that DAGMC models contain so many triangles that it is prohibitively slow to plot such a model even in
Visit or Paraview, in such a case it has proven useful to extract the faceted curves from the file and plot those. This can be
achieved with,</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; mbconvert -1 dagmc.h5m curves.h5m
prompt%&gt; mbconvert curves.h5m curves.vtk
</pre></div>
</div>
<p>Note that in the above example that first we must extract the curve information write to a new h5m file, and then convert that
file to a vtk file. When plotting the curves that define the boundary of each volume should be visible, an example of this is
shown below.</p>
<a class="reference internal image-reference" href="../_images/fng_curves.png"><img alt="Image showing the FNG curve information" src="../_images/fng_curves.png" style="width: 300px; height: 300px;" /></a>
<a class="reference internal image-reference" href="../_images/fng_facets.png"><img alt="Image showing the FNG facet information" src="../_images/fng_facets.png" style="width: 300px; height: 300px;" /></a>
</div>
<div class="section" id="make-watertight">
<h2>make_watertight<a class="headerlink" href="#make-watertight" title="Permalink to this headline">¶</a></h2>
<p>When models are faceted by dagmc_preproc, facets are not guarenteed to be water tight, by which it is meant that
the edge of facets of one surface do not exactly align with those of another surface, such discrepancies can lead to numerical
gaps through which particles can leak. The make_watertight tool alleviates this problem by using the underlying faceted curve
representation to force triangle edges to be coincident along curves, this action closes any gaps and if succesful the model is
guarenteed to be water tight. The tool is run in the following way,</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; make_wateright &lt;filename&gt;
</pre></div>
</div>
<p>The result of this step is a new file with the name, &lt;filename&gt;_zip.h5m, which can then be run with the rest of the workflow. The
degree of water tightness can be checked with the partner tool to make_wateright, check_wateright. When run it will give a summary
of how sealed the mode is. The check_watertight tool is run by:</p>
<div class="highlight-python"><div class="highlight"><pre>prompt%&gt; check_watertight &lt;filename&gt;
</pre></div>
</div>
</div>
<div class="section" id="mklostvis">
<h2>mklostvis<a class="headerlink" href="#mklostvis" title="Permalink to this headline">¶</a></h2>
<p>Sometimes either poor quality CAD, incorrect imprinting &amp; merging or overlapping volumes; particles are regarded as lost
by the Monte Carlo code. It is therefore neccessary to be able to examine where the particles were lost and in which direction they
were travelling in. The tool <a class="reference external" href="https://github.com/svalinn/meshtools/tree/master/lostparticles">mklostvis</a> is designed for this
purpose, reading the output of the MCNP lost particle information and producing a <a class="reference external" href="https://cubit.sandia.gov/">Cubit</a> journal
file which will draw the lost particles as vertices and their directions as curves. To run the script;</p>
<div class="highlight-python"><div class="highlight"><pre>prompt %&gt; mklostvis.pl [mcnp output filename] [vector length] &gt; [journal file name]
</pre></div>
</div>
<p>The produced Cubit journal file can be &#8216;played&#8217;, and will plot these lost particles on top of whatever geometry is loaded into
your Cubit session, like that shown below.</p>
<a class="reference internal image-reference" href="../_images/lost_p.png"><img alt="Image showing lost particle information" src="../_images/lost_p.png" style="width: 300px; height: 300px;" /></a>
<a class="reference internal image-reference" href="../_images/lost_p_zoom.png"><img alt="Image showing lost particle information zoomed in" src="../_images/lost_p_zoom.png" style="width: 300px; height: 300px;" /></a>
</div>
</div>


          </div>
      </div>

    </div>
</div>
    <div id="footer">
      <p>
        &copy; Copyright 2012-2015, The UW CNERG Team.
      </p>
      <p>
      Last updated on Nov 09, 2015.
      </p>
      <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
      </p>
    </div>
  </body>
</html>