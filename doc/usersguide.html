

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DAGMC User’s Guide &mdash; DAGMC</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="DAGMC" href="../index.html" />
    <link rel="prev" title="What is DAGMC?" href="../index.html" /> 
  </head>
  <body> 
<div id="page-div" class="page">
<div id="header"><a id="uwhome" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/wordmark.gif" alt="University of Wisconsin–Madison" width="260" height="11" /></a> <a id="crest" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/crest.png" alt="" width="70" height="106" /></a>
    <h1 id="siteTitle"><a href="/"><span>DAGMC</span></a></h1>
    <div id="tagline"><span>Direct Accelerated Geometry Monte Carlo Toolkit</span></div>
    <ul id="globalnav">
      <li id="uwsearch"><a href="http://www.wisc.edu/search/">UW Search</a></li>
      <li><a href="http://cnerg.github.com">CNERG</a></li>
      <li><a href="http://my.wisc.edu">My UW</a></li>
      <li><a href="http://map.wisc.edu">Map</a></li>
      <li id="last_tool"><a href="http://www.today.wisc.edu">Calendar</a></li>
    </ul>
    <form role="search" action="../search.html" method="get" id="cse-search-box">
      <div>
      <label class="screen-reader-text" for="q">Search for:</label>
      <input type="text" id="q" name="q" value="Enter keywords here...." />
      <input type="submit" id="sa" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </div>
    </form>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

    <div id="nav" class="main-menu-container">
      <ul id="menu-main" class="sf-menu">
        <li class="menu-item"><a href="../index.html">DAGMC</a></li>
        <li class="menu-item" style="margin-right: 10px">
          <a href="../index.html" title="What is DAGMC?"
             accesskey="P">previous</a>
          </li>
        <li class="menu-item" >
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
          </li> 
      </ul>
    </div>
  <div id="c_container"> 
<div id="sidebar">
 <div id="sidebar_section"></div>
 <div id="sidebar_section"><ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">DAGMC User&#8217;s Guide</a></li>
</ul>
 </div>
</div> 
    <div id="content" class="inline-block">
          <div class="post">
            
  <div class="section" id="dagmc-user-s-guide">
<h1>DAGMC User&#8217;s Guide<a class="headerlink" href="#dagmc-user-s-guide" title="Permalink to this headline">¶</a></h1>
<p>This document is intended for users of the DAGMC toolkit and includes
instructions for installation and use with a variety of Monte Carlo
codes.</p>
<hr class="docutils" />
<div class="section" id="getting-installing-the-dagmc-toolkit">
<h2>Getting &amp; Installing the DAGMC Toolkit<a class="headerlink" href="#getting-installing-the-dagmc-toolkit" title="Permalink to this headline">¶</a></h2>
<p>DAGMC is a toolkit that provides direct geometry support to any Monte
Carlo radiation transport code.  The primary code used for development
and testing of DAGMC is <a class="reference external" href="http://mcnp-green.lanl.gov/">MCNP5</a>,
developed by <a class="reference external" href="http://www.lanl.gov">Los Alamos National Laboratory</a>
and distributed by the <a class="reference external" href="http://rsicc.ornl.gov">Radiation Safety Information Computing Center</a>.  There has also been experience with MCNPX
(LANL) and Tripoli4 (CEA/Saclay).</p>
<p>These instructions describe the basic steps for downloading and
installing the software libraries that provide the DAGMC toolkit for
integration with Monte Carlo codes.  After this, code-specific
instructions will be give for each code. For access to the DAGMC
toolkit alone, the following combination of software
packages/libraries is necessary:</p>
<ul>
<li><p class="first"><a class="reference external" href="http://trac.mcs.anl.gov/projects/ITAPS/wiki/MOAB">MOAB/DAGMC</a>
(SVN: <a class="reference external" href="https://svn.mcs.anl.gov/repos/ITAPS/MOAB/trunk">https://svn.mcs.anl.gov/repos/ITAPS/MOAB/trunk</a>)</p>
<blockquote>
<div><ul>
<li><p class="first"><a class="reference external" href="http://www.hdfgroup.org/HDF5/release/obtain5.html">HDF5</a></p>
</li>
<li><p class="first"><a class="reference external" href="http://trac.mcs.anl.gov/projects/ITAPS/wiki/CGM">CGM</a> (SVN:
<a class="reference external" href="https://svn.mcs.anl.gov/repos/ITAPS/cgm/trunk">https://svn.mcs.anl.gov/repos/ITAPS/cgm/trunk</a>)</p>
<blockquote>
<div><ul class="simple">
<li>ACIS v16, or <a class="reference external" href="http://cubit.sandia.gov">CUBIT</a> v10.2</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="installing-the-dagmc-toolkit">
<h3>Installing the DAGMC Toolkit<a class="headerlink" href="#installing-the-dagmc-toolkit" title="Permalink to this headline">¶</a></h3>
<p>The following 4 steps are required to install the MOAB library,
including the DAGMC toolkit, for use in Monte Carlo radiation
transport tools.</p>
<ol class="arabic simple">
<li>Install <a class="reference external" href="http://cubit.sandia.gov">CUBIT</a> v10.2</li>
<li>Install <a class="reference external" href="http://trac.mcs.anl.gov/projects/ITAPS/wiki/CGM">CGM</a>, using the &#8211;with-cubit options</li>
<li>Install <a class="reference external" href="http://www.hdfgroup.org/HDF5/">HDF5</a></li>
<li>Install <a class="reference external" href="http://trac.mcs.anl.gov/projects/ITAPS/wiki/MOAB">MOAB</a>,
using the &#8211;with-cgm and &#8211;with-hdf5 options (&#8211;with-netcdf may
also be useful but not necessary)</li>
</ol>
<p>Here are some assumptions/conventions that are used in these instructions:</p>
<ul class="simple">
<li>all operations are carried out in the a subdirectory <tt class="docutils literal"><span class="pre">dagmc_bld</span></tt> of a user&#8217;s home directory</li>
<li>path to CUBIT files is known, e.g. <tt class="docutils literal"><span class="pre">/path/to/cubit</span></tt></li>
<li>all tarballs reside in user&#8217;s home directory</li>
</ul>
<p>If these do not apply to you, please modify your steps accordingly.</p>
<blockquote>
<div><em>(For a shortcut to installing DAG-MCNP5.1.51 you may be able to use the DagmcBuildPackage .)</em></div></blockquote>
<div class="section" id="installing-cgm">
<h4>Installing CGM<a class="headerlink" href="#installing-cgm" title="Permalink to this headline">¶</a></h4>
<p>Create a directory to build CGM:</p>
<div class="highlight-python"><pre>prompt%&gt; mkdir -p $HOME/dagmc_bld/CGM/bld
prompt%&gt; cd $HOME/dagmc_bld/CGM</pre>
</div>
<p>If installing from SVN repository:</p>
<div class="highlight-python"><pre>prompt%&gt; svn co https://svn.mcs.anl.gov/repos/ITAPS/cgm/trunk
prompt%&gt; cd trunk
prompt%&gt; autoreconf -fi
prompt%&gt; cd ..
prompt%&gt; ln -s trunk src</pre>
</div>
<p>If installing from a tarball, <tt class="docutils literal"><span class="pre">CGM-10.2.2.tar.gz</span></tt>:</p>
<div class="highlight-python"><pre>prompt%&gt; tar xzf ~/CGM-10.2.2.tar.gz
prompt%&gt; ln -s CGM-10.2.2 src</pre>
</div>
<p>In all cases:</p>
<div class="highlight-python"><pre>prompt%&gt; cd bld
prompt%&gt; ../src/configure --enable-optimize --disable-debug \
          --with-cubit=/path/to/cubit  \
          --prefix=$HOME/dagmc_bld/CGM
prompt%&gt; make
prompt%&gt; make install</pre>
</div>
</div>
<div class="section" id="installing-hdf5">
<h4>Installing HDF5<a class="headerlink" href="#installing-hdf5" title="Permalink to this headline">¶</a></h4>
<p>Follow these steps</p>
<div class="highlight-python"><pre>prompt%&gt; mkdir $HOME/dagmc_bld/HDF5/bld
prompt%&gt; cd $HOME/dagmc_bld/HDF5
prompt%&gt; tar xzf ~/hdf5-1.8.3.tar.gz
prompt%&gt; ln -s hdf5-1.8.3 src
prompt%&gt; cd bld
prompt%&gt; ../src/configure --prefix=$HOME/dagmc_bld/HDF5
prompt%&gt; make
prompt%&gt; make install</pre>
</div>
</div>
<div class="section" id="installing-moab">
<h4>Installing MOAB<a class="headerlink" href="#installing-moab" title="Permalink to this headline">¶</a></h4>
<p>Create a directory to install MOAB:</p>
<div class="highlight-python"><pre>prompt%&gt; mkdir -p $HOME/dagmc_bld/MOAB/bld
prompt%&gt; cd $HOME/dagmc_bld/MOAB</pre>
</div>
<p>If installing from SVN repository:</p>
<div class="highlight-python"><pre>prompt%&gt; svn co https://svn.mcs.anl.gov/repos/ITAPS/MOAB/trunk
prompt%&gt; cd trunk
prompt%&gt; autoreconf -fi
prompt%&gt; cd ..
prompt%&gt; ln -s trunk src</pre>
</div>
<p>If installing from a tarball, <tt class="docutils literal"><span class="pre">MOAB-3.99.tar.gz</span></tt>:</p>
<div class="highlight-python"><pre>prompt%&gt; tar xzf ~/MOAB-3.99.tar.gz
prompt%&gt; ln -s MOAB-3.99 src</pre>
</div>
<p>In all cases:</p>
<div class="highlight-python"><pre>prompt%&gt; cd bld
prompt%&gt; ../src/configure --enable-optimize --disable-debug \
          --with-cgm=$HOME/dagmc_bld/CGMA  \
          --with-hdf5=$HOME/dagmc_bld/HDF5 \
          --prefix=$HOME/dagmc_bld/MOAB
prompt%&gt; make
prompt%&gt; make install</pre>
</div>
</div>
</div>
<div class="section" id="applying-dagmc-to-specific-monte-carlo-codes">
<h3>Applying DAGMC to Specific Monte Carlo Codes<a class="headerlink" href="#applying-dagmc-to-specific-monte-carlo-codes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="installing-dag-mcnp5">
<h4>Installing DAG-MCNP5<a class="headerlink" href="#installing-dag-mcnp5" title="Permalink to this headline">¶</a></h4>
<p>If you would like to use DAGMC with MCNP5, known as DAG-MCNP5, you will also need:</p>
<ul class="simple">
<li>MCNP5.1.51 source code from <a class="reference external" href="http://rsicc.ornl.gov">RSICC</a></li>
<li>DAG-MCNP5.1.51 patch file from the UW-Madison</li>
</ul>
<div class="section" id="automatic-installation">
<h5>Automatic Installation<a class="headerlink" href="#automatic-installation" title="Permalink to this headline">¶</a></h5>
<p>A package has been prepared that includes many of the requires
software libraries and an automated build script.  Because the DAGMC
team is not authorized to distribute <a class="reference external" href="http://cubit.sandia.gov">CUBIT</a> nor <a class="reference external" href="http://mcnp.lanl.gov">MCNP5.1.51 source code</a>, you must acquire those through the
appropriate channels on your own.</p>
<p>Once you have both of those things, you should be able to use the
DagmcBuildPackage to create a working install of DAG-MCNP5.1.51.</p>
</div>
<div class="section" id="manual-installation">
<h5>Manual Installation<a class="headerlink" href="#manual-installation" title="Permalink to this headline">¶</a></h5>
<p>The following steps are required to install DAG-MCNP5.  Most of these steps are described in more detail below.</p>
<ol class="arabic">
<li><p class="first">Install the DAGMC Toolkit as described above</p>
</li>
<li><dl class="first docutils">
<dt>Download a copy of the patch file for your version of MCNP:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="/software/dagmc.patch.5.1.51">MCNP5 v1.51</a></li>
<li><a class="reference external" href="/software/dagmc.patch.5.1.40">MCNP4 v1.40</a></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Apply the patch your copy of the MCNP5.1.51 source code</p>
</li>
<li><p class="first">Build &amp; install the patched version of MCNP5</p>
</li>
</ol>
<p>Some assumptions/conventions:</p>
<ul class="simple">
<li>all operations are carried out in the a subdirectory <tt class="docutils literal"><span class="pre">dagmc_bld</span></tt> of a user&#8217;s home directory</li>
<li>path to CUBIT files is known, e.g. <tt class="docutils literal"><span class="pre">/path/to/cubit</span></tt></li>
<li>all tarballs reside in user&#8217;s home directory</li>
<li>MCNP5 source code is available in location <tt class="docutils literal"><span class="pre">$HOME/dagmc_bld/MCNP5</span></tt></li>
</ul>
<div class="section" id="apply-dagmc-patch-to-mcnp5-v1-51">
<h6>Apply DAGMC Patch to MCNP5 v1.51<a class="headerlink" href="#apply-dagmc-patch-to-mcnp5-v1-51" title="Permalink to this headline">¶</a></h6>
<p>Perform the following steps:</p>
<div class="highlight-python"><pre>prompt%&gt; cd $HOME/dagmc_bld/MCNP5/Source
prompt%&gt; patch -p 0 &lt; ~/dagmc_install.patch</pre>
</div>
</div>
<div class="section" id="build-dag-mcnp5-from-modified-code">
<h6>Build DAG-MCNP5 from modified code<a class="headerlink" href="#build-dag-mcnp5-from-modified-code" title="Permalink to this headline">¶</a></h6>
<p>One of the easiest ways to build DAG-MCNP5 is directly using the
<tt class="docutils literal"><span class="pre">makefile</span></tt> from the command-line.  To do this, you must know the
<tt class="docutils literal"><span class="pre">makefile</span></tt> options to build a version of MCNP5 without DAGMC,
usually in the form:</p>
<div class="highlight-python"><pre>prompt%&gt; make build CONFIG="seq plot gfortran" FC=gfortran MARCH=M64``</pre>
</div>
<p>or similar.  Starting from these options, you can build DAG-MCNP5 from
a patched source code with:</p>
<div class="highlight-python"><pre>prompt%&gt; make build CONFIG="seq plot gfortran dagmc" FC=gfortran MARCH=M64 \
             MOAB_DIR=$HOME/dagmc_bld/MOAB CUBIT_DIR=/path/to/cubit</pre>
</div>
<p>If you are less familiar with building MCNP5 from the <tt class="docutils literal"><span class="pre">makefile</span></tt> you
may want to use the interactive <tt class="docutils literal"><span class="pre">install</span></tt> script provided by LANL:</p>
<div class="highlight-python"><pre>prompt%&gt; ./install</pre>
</div>
<p>Within the <tt class="docutils literal"><span class="pre">install</span></tt> program you will need to set the DAGMC build options:</p>
<ul class="simple">
<li>turn on DAGMC mode</li>
<li>provide the path to MOAB: <tt class="docutils literal"><span class="pre">$HOME/dagmc_bld/MOAB</span></tt></li>
<li>provide the path to CUBIT: <tt class="docutils literal"><span class="pre">/path/to/cubit</span></tt></li>
</ul>
<p>From the main menu, choose <tt class="docutils literal"><span class="pre">C</span></tt> to compile.</p>
<p>Your executable should be available as <tt class="docutils literal"><span class="pre">$HOME/dagmc_bld/MCNP5/Source/src/mcnp5</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="access-to-dag-tripoli4">
<h4>Access to DAG-Tripoli4<a class="headerlink" href="#access-to-dag-tripoli4" title="Permalink to this headline">¶</a></h4>
<p>Tripoli4 is distributed by CEA/Saclay as a binary executable.  For
access to DAG-Tripoli4, please contact <a class="reference external" href="mailto:jean-christophe&#46;trama&#37;&#52;&#48;cea&#46;fr">Jean-Christophe Trama</a>.</p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="using-dagmc-the-dagmc-workflow">
<h2>Using DAGMC - The DAGMC Workflow<a class="headerlink" href="#using-dagmc-the-dagmc-workflow" title="Permalink to this headline">¶</a></h2>
<p>The following steps are necessary to perform an analysis with most
DAGMC versions of Monte Carlo radiation transport codes. (see below
for more details on each step)</p>
<ol class="arabic">
<li><p class="first">create and/or prepare a solid model using the CAD/solid-modeling tool of your choice</p>
</li>
<li><dl class="first docutils">
<dt>pre-processing of the solid model geometry in CUBIT</dt>
<dd><ul class="first last simple">
<li>assign materials and densities</li>
<li>define boundary conditions</li>
<li>imprint &amp; merge geometry</li>
<li>export that model in the ACIS format</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">prepare native MC code input file
* understanding additional <tt class="docutils literal"><span class="pre">dagmc</span></tt> parameters</p>
</li>
<li><p class="first">Run MC code, possibly with additional command line parameters</p>
</li>
</ol>
<div class="section" id="preparing-solid-models">
<h3>Preparing Solid Models<a class="headerlink" href="#preparing-solid-models" title="Permalink to this headline">¶</a></h3>
<p>In theory, solid models can be prepared in any modeling software
system (e.g. SolidWorks, Pro/E, Catia, etc).  What is most important
about the choice of solid modeling system is the ability to export to
a format that can be imported by CUBIT, in particular:</p>
<ul class="simple">
<li>ACIS (<a href="#id5"><span class="problematic" id="id6">*</span></a>.sat)</li>
<li>STEP (<a href="#id7"><span class="problematic" id="id8">*</span></a>.stp, <a href="#id9"><span class="problematic" id="id10">*</span></a>.STEP, etc)</li>
</ul>
<p>There are a number of concepts to consider while preparing a solid
model; however, the most important considerations are small gaps and
overlaps that might exist in the model. These gaps and overlaps can
lead to rapid failure when running a DAGMC-based analysis. The
following steps are provided to help make a more robust model <em>before</em>
running your DAGMC-based analysis.</p>
<p>Be aware: obtaining a robust model may be an iterative and time
consuming process. In some cases, the validity of the model will
require running a DAGMC-based analysis and assessing whether or not
the model yielded expected results or a small enough number of lost
particles. If the results did not meet expectations, changes to the
model may be in order.</p>
<div class="section" id="knowing-the-model">
<h4>Knowing the model<a class="headerlink" href="#knowing-the-model" title="Permalink to this headline">¶</a></h4>
<p>The first consideration to address is where the solid model originated
and for what purpose. In many instances, models constructed for
manufacturing purposes will have tolerances that are undesirable for
particle transport applications. For example, a gap might exist
between fuel pellets and the cladding wall for a PWR fuel rod. While
this is perfectly acceptable for an individual manufacturing the rod,
the gap could potentially cause present problems in a DAGMC-based
analysis, depending on how it is modeled.</p>
<p>Knowing who created the model and to what purpose provides a starting
point for preparing the model. If it was made with particle transport
in mind, then very little work may be needed; but as with the example
above, some models may require changes to accommodate the needs of a
DAGMC-based analysis.</p>
</div>
<div class="section" id="identifying-weaknesses-in-the-model">
<h4>Identifying weaknesses in the model<a class="headerlink" href="#identifying-weaknesses-in-the-model" title="Permalink to this headline">¶</a></h4>
<p>When assessing a model that is to be used for particle transport two
primary concerns must addressed. These concerns are:</p>
<blockquote>
<div><ul class="simple">
<li>Gaps</li>
<li>Overlaps</li>
</ul>
</div></blockquote>
<p>Gaps occur when the surfaces of two volumes/parts that should be in
contact are set apart from each instead of having coincident
surfaces. The size of the gap is generally unimportant, for most solid
modeling programs, a gap is a gap. The desired result is to have all
surfaces of volumes/parts to be coincident. If coincidence is not
achieved, particles may become lost when entering the region between
the surfaces.</p>
<p>Overlaps are found where two or more volumes/parts encroach upon the
same space. As with gaps, the magnitude of the overlapping volume is
usually unimportant.  When a particle enters a region of overlap, it
may not correctly determine which volume/part it resides in. If this
occurs, the particle may become lost.</p>
<p>Identifying gaps and overlaps may be difficult and time consuming;
however, some 3D modeling programs like SolidWorks have built in tools
to identify these occurrences. Rely on the modeling program to
identify these errors (the gaps and overlaps) and use the steps in the
next section to change, reduce and remove their effect on the model.</p>
</div>
<div class="section" id="modifying-your-model">
<h4>Modifying your model<a class="headerlink" href="#modifying-your-model" title="Permalink to this headline">¶</a></h4>
<p>Once the gaps and overlaps in the model have been identified, the
three following methods may be used to change, reduce and remove their
effect on the model.</p>
<ul class="simple">
<li>Create &#8220;voided&#8221; geometries</li>
<li>Modify volume/part dimensions</li>
<li>Remove superfluous details</li>
</ul>
<p>Each method is discussed in detail below:</p>
<p>As with the fuel rod example mentioned above, some geometries that are
&#8216;gaps&#8217; are also important. Instead of removing the gap entirely (by
changing the dimensions of the cladding or the fuel to force
coincidence), a new volume/part could be modeled that coincided with
the outer diameter of the fuel AND the inner diameter of the
cladding. Now a &#8220;voided&#8221; geometry occupies the previously unaccounted
for region. By specifying these &#8220;voided&#8221; geometries in a DAGMC-based
analysis, the physical importance of the region can be retained while
accomodating the requirement of having coincident surfaces.</p>
<p>Another method to resolve gaps and overlaps is to simply change the
dimensions of the volume/part (eg: making a dimension several cm
bigger or smaller to ensure coincidence surfaces). In many instances
this method could compromise the physics of the solution and is then
undesirable. However, in other instances, this solution is very
logical. One particularly significant example is if different volumes
were modeled with different unit system. For example, one volume/part
might have been model in [in] while its neighbor was modeled in [cm];
while the surfaces may be nearly coincidence, rounding errors might
prevent coincidence from occurring. A simple change to one dimension
may hardly change the volume/part&#8217;s characteristics yet result in
coincidence.</p>
<p>Finally, superfluous details may prevent a volume/part from coinciding
with its neighbors properly. A potential solution is to simply remove
the superfluous detail to simplfy the model and ensure the desired
surfaces are coincident. Some volumes/parts will inherently hurt the
model&#8217;s effectiveness either due to its complex features or small
dimensions. A volume/part&#8217;s effect on the model cannot truly be
assessed until a DAGMC-based analysis is run. This final method is
usually implemented in attempt to reduce the number of lost particles
while maintaining the most important characteristics of the system.</p>
<dl class="docutils">
<dt><a href="#id11"><span class="problematic" id="id12">*</span></a>Note: Of all steps, the removal of superfluous details is the most</dt>
<dd>subjective and heavily dependent on the model&#8217;s intended
application.*</dd>
</dl>
</div>
<div class="section" id="assessing-your-model">
<h4>Assessing your model<a class="headerlink" href="#assessing-your-model" title="Permalink to this headline">¶</a></h4>
<p>Lost particles are undesirable; lost particles usually indicate
weaknesses and failures within the geometry. While the goal of the
DAGMC project is to guarantee that there will never be lost particles,
they can occur even on robust geometries.  It is up to the
user/analyst to determine what lost particle rate they consider
acceptable.  The UW-Madison group usually considers lost particle
rates that are less than 1/50,000 to be a threshold for most problems.
It is important to understand whether particles are being lost from an
important region of your phase space.</p>
<p>[Insert note on the implicit complement here]</p>
</div>
</div>
<div class="section" id="pre-processing-solid-models-using-cubit">
<h3>Pre-processing Solid Models using CUBIT<a class="headerlink" href="#pre-processing-solid-models-using-cubit" title="Permalink to this headline">¶</a></h3>
<p><em>Note: For large models, the steps described below can be very tedious
and time consuming.  To accelerate the process, an automated approach
is available for models that have been properly prepared in the native
solid modeling software.  This AutomatedCubitConversion process is
described elsewhere, but reading the information below will provided
the knowledge-base needed to understand the automation process.</em></p>
<p>This section focuses on steps that are independent of the MC code used
for analysis.  Additional steps for <a class="reference external" href="#S2Di">DAG-MCNP5</a> and
<a class="reference external" href="#S2Dii">DAG-Tripoli4</a> may be based on the instructions given here,
but are provided in separate parts of section 2.D below.</p>
<div class="section" id="importing-the-solid-model">
<h4>Importing the Solid Model<a class="headerlink" href="#importing-the-solid-model" title="Permalink to this headline">¶</a></h4>
<p>The first step in CUBIT is to import the generated solid
model. Depending on the complexity of the model, this step can take
several seconds up to a half an hour. As an initial user, it is
recommend to start with simple models and geometries to obtain a
better understanding of CUBIT.</p>
</div>
<div class="section" id="imprint-and-merge">
<h4>Imprint and Merge<a class="headerlink" href="#imprint-and-merge" title="Permalink to this headline">¶</a></h4>
<p>For a DAGMC-based analysis to work properly, all of the surfaces must
be imprinted and merged.  Imprinting creates a common surface
interface between touching volumes.  Merging then takes the touching
surfaces and makes them into one surface.</p>
<p>To imprint, issue the following command</p>
<div class="highlight-python"><pre>imprint body all</pre>
</div>
<p>Should the imprint be successful, then the next step is to merge the
geometry. Sometimes it may be important to specify a merge tolerance.
To set the tolerance and merge, issue the following commands: :: merge
tol 5e-7 merge all</p>
<p>This process can be very time consuming. For large models of several
thousand volumes, the imprint and merge steps can take up to three
hours. However, small geometries (on the order of 100 volumes) the
process is rather quick.</p>
</div>
<div class="section" id="grouping-volumes-and-surfaces">
<h4>Grouping Volumes and Surfaces<a class="headerlink" href="#grouping-volumes-and-surfaces" title="Permalink to this headline">¶</a></h4>
<p>A DAGMC-based analysis allows a number of attributes of the geometry
to be defined within the geometry file. These characteristics
generally relate to the physical behavior of the volume, for example
its material definition or boundary conditions.</p>
<p>Before the discussion of specific attributes, the practice of
&#8220;grouping&#8221; needs to be explained. A group is essentially a collection
of volumes or surfaces that share a common attribute; the practical
usage of &#8220;grouping&#8221; will be explained in the next section.</p>
<p>The general format for creating/adding volumes to a group is:</p>
<div class="highlight-python"><pre>group "group.name" add vol/surf ...</pre>
</div>
<p>For example, to create a group called &#8220;moderator&#8221; containing volumes
5, 6, 7, and 10, the following command would be used:</p>
<div class="highlight-python"><pre>group "moderator" add vol 5 to 8 10</pre>
</div>
<p>Another example, shows that groups don&#8217;t have to be just contain
volumes, but can contain surfaces too. Below the group
&#8220;shield.boundary&#8221; is created with surfaces 16 and 37:</p>
<div class="highlight-python"><pre>group "shield.boundary" add surf 16 37</pre>
</div>
<p>Due to the importance of using the <tt class="docutils literal"><span class="pre">group</span></tt> command reading the CUBIT
manual section on its full usage is highly recommended.</p>
</div>
<div class="section" id="finishing-up-and-final-notes">
<h4>Finishing Up and Final Notes<a class="headerlink" href="#finishing-up-and-final-notes" title="Permalink to this headline">¶</a></h4>
<p>Before exporting, it is vital to set attributes on.  This saves the
absolute volume and surface IDs as well as any group specifications.
Failing to do this will result in fatal errors.  Make sure to type the
following:</p>
<div class="highlight-python"><pre>set attribute on</pre>
</div>
<p>Finally, export the file as an ACIS file with a .sat extension.  If
you are using a version of CUBIT newer that v10.x, be sure to set the
ACIS geometry level back to version 16:</p>
<div class="highlight-python"><pre>set geom version 1600</pre>
</div>
<p>For the remainder of this documentation, the geometry file will be
referred to as &#8220;geom.sat&#8221;. Also, as noted before, the CUBIT conversion
process can be automated as described on the follow webpage:
AutomatedCubitConversion.</p>
</div>
</div>
<div class="section" id="additional-input-parameters-for-dagmc">
<h3>Additional Input Parameters for DAGMC<a class="headerlink" href="#additional-input-parameters-for-dagmc" title="Permalink to this headline">¶</a></h3>
<p>DAGMC introduces a number of new input variables that control the
behavior of DAGMC when it interacts with your geometry.  This section
describes the conceptual behavior of those parameters and later
sections will describe their specific implementation and syntax within
each code.</p>
<div class="section" id="geometry-file-basic">
<h4>Geometry File (basic)<a class="headerlink" href="#geometry-file-basic" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>required</li>
<li>Default: none</li>
</ul>
<p>This file contains the geometry that has been created and
pre-processed using the workflow described above.  This file can be
either an ACIS geometry (usually with a <tt class="docutils literal"><span class="pre">.sat</span></tt> file extension) or a
MOAB facet file (usually with a <tt class="docutils literal"><span class="pre">.h5m</span></tt> file extension).</p>
</div>
<div class="section" id="faceting-tolerance-basic">
<h4>Faceting Tolerance (basic)<a class="headerlink" href="#faceting-tolerance-basic" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>optional</li>
<li>Default: 0.001</li>
</ul>
<p>One of the first steps performed by DAGMC is to generate a faceted
representation of your solid model.  To ensure a faithful
representation of the model, the facets are constrained such that all
points on each facet are within a tolerance of the nearest points on
the exact surface representation.  A smaller tolerance results in a
more faithful representation of the surface at the penalty of
producing more facets.  The user can control the faceting tolerance
using when they invoke their simulation, either on the command line or
in the input file, depending on the MC code being used for the
analysis.  This option only has an effect with the geometry file is a
solid model and not when it is a facet file.</p>
</div>
<div class="section" id="facet-file-basic">
<h4>Facet File (basic)<a class="headerlink" href="#facet-file-basic" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>optional</li>
<li>Default: none</li>
</ul>
<p>For some models, the initial processing can be time consuming.  When
reading a solid model geometry, this option causes a processed file to
be written that can be used on subsequent analyses.  This file will be
processed with the facet tolerance as defined above.  This facet
tolerance cannot be changed when the file is reused.</p>
</div>
<div class="section" id="overlap-thickness-advanced">
<h4>Overlap Thickness (advanced)<a class="headerlink" href="#overlap-thickness-advanced" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>optional</li>
<li>Default: 0.0</li>
</ul>
<p>Often CAD geometry has small overlaps between adjacent volumes due to
file translation or imprecise modeling. The particle tracking
algorithm can accommodate small overlaps if the maximum thickness of
overlaps is approximately known.</p>
</div>
<div class="section" id="source-cell-treatment-intermediate">
<h4>Source Cell Treatment (intermediate)<a class="headerlink" href="#source-cell-treatment-intermediate" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>optional</li>
<li>Default: on (same behavior as native code)</li>
</ul>
<p>The implementation of this option is specific to the Monte Carlo code
being used.  Please refer to the documentation for your underlying
Monte Carlo code.</p>
</div>
<div class="section" id="use-cad-geometry-advanced">
<h4>Use CAD geometry (advanced)<a class="headerlink" href="#use-cad-geometry-advanced" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>optional</li>
<li>Default: off</li>
</ul>
<p>When this option is turned on, the ray-firing process finds the
intersection with the CAD-based solid model itself, and not just with
the faceted representation of that model.  The facet-based ray-firing
solution is used as an initial guess to solve for the point on the
actual CAD surface where the ray-surface intersection takes place.
This option is only available when the DAGMC toolkit has been linked
to the ACIS geometry libraries directly and not when it has been
linked via CUBIT.</p>
</div>
<div class="section" id="use-distance-limit-experimental">
<h4>Use Distance Limit (experimental)<a class="headerlink" href="#use-distance-limit-experimental" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>optional</li>
<li>Default: off</li>
</ul>
<p>This option allows a previously determined distance to the next
collision to be used to accelerate the search for ray-surface
intersections.  Any candidate ray-surface intersection that is at a
distance beyond the known distance to collision will be rejected,
including bounding box tests in the OBB tree search.</p>
</div>
</div>
<div class="section" id="monte-carlo-code-specific-steps">
<h3>Monte Carlo Code-Specific Steps<a class="headerlink" href="#monte-carlo-code-specific-steps" title="Permalink to this headline">¶</a></h3>
<p>There are three varieties of code-specific steps:</p>
<ol class="arabic simple">
<li>defining attributes of the geometry using groups in CUBIT</li>
<li>defining DAGMC runtime parameters using input file syntax</li>
<li>changes to the command-line</li>
</ol>
<p>In this section, these steps are described for each of the supported Monte Carlo codes.</p>
<div class="section" id="id13">
<h4>DAG-MCNP5<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="section" id="geometry-metadata">
<h5>Geometry Metadata<a class="headerlink" href="#geometry-metadata" title="Permalink to this headline">¶</a></h5>
<p>In DAG-MCNP5, the geometry file can be used to define material and
density assignments, boundary conditions, and tally locations.</p>
<div class="section" id="assigning-materials-densities">
<h6>Assigning Materials &amp; Densities<a class="headerlink" href="#assigning-materials-densities" title="Permalink to this headline">¶</a></h6>
<p>The generic workflow description outlines the <a class="reference external" href="#S2Biii">principles of grouping</a>, but a specific naming convention is required for
DAG-MCNP5. To define materials, both the MCNP material ID and density
must be provided in the group name. The format for the group name is
as follows:</p>
<div class="highlight-python"><pre>mat_[matid]_rho_[density]</pre>
</div>
<p><tt class="docutils literal"><span class="pre">[matid]</span></tt> is replaced by the material ID that will be specified in
the MCNP input file.  <tt class="docutils literal"><span class="pre">[density]</span></tt> is replaced by either the atomic
density or the mass density.  Like the MCNP cell cards, positive
values are atomic densities in [atoms/barn-cm] and negative values are
mass densities in [g/cc].</p>
<p>For example, suppose UO2 is material 7 in the problem, has an atomic
density of 0.0223 and volumes 4 through 18 consist of this material.
To assign materials to these volumes, the following command would be
used:</p>
<div class="highlight-python"><pre>group "mat_7_rho_0.0223" add vol 4 to 18</pre>
</div>
<p><em>Note: If a volume is not assigned to a specific group, when run in
DAGMC it will be treated as a void; the material for that cell will
be zero. This can actually become a fairly useful debugging tool to
identify volumes that were not assigned to their appropriate group.</em></p>
<p>If you would like to assign a material to the explicit complement, you
can use the same mechanism, but add the string <tt class="docutils literal"><span class="pre">_comp</span></tt> to the end of
the group name.  Since DAGMC only recognizes those groups that contain
an entity, it is necessary to add a volume to this group, recognizing
that this material will NOT be assigned to that volume.  (<em>It is often
convenient to assign the graveyard volume (see below) to the implicit
complement material group to minimize confusion.</em>) For example, if you
would like the explicit complement to be modeled as material 9 with
density 1 g/cc:</p>
<div class="highlight-python"><pre>create group "mat_9_rho_-1_comp"</pre>
</div>
</div>
<div class="section" id="defining-boundary-conditions">
<h6>Defining Boundary Conditions<a class="headerlink" href="#defining-boundary-conditions" title="Permalink to this headline">¶</a></h6>
<p>There are two general classes of boundary condition supported by
DAG-MCNP5. a vacuum boundary and reflecting surfaces, and they are
implemented in different ways.</p>
<ul class="simple">
<li><strong>Defining the &#8220;graveyard&#8221;: vacuum boundaries</strong></li>
</ul>
<p>A typical usage of MCNP5 includes a volume that extends to infinity with an importance of 0 that bounds the active volumes of interest.  Since solid models cannot include any infinite volumes, it is necessary to place a finite volume of importance 0 to define the problem boundary. You will need to surround the entire geometry with a shell of finite thickness, known as the &#8220;graveyard&#8221;.  Any geometric shape can be used for this; however, a cubic shell is preferred.  This shell volume will represent the outside world and will be the cell where all of the particles are terminated (thus it will have an importance of zero).</p>
<p>To create this volume create two volumes in CUBIT with the same shape, same center, and one slightly larger than the other.  Subtract the smaller from the larger.  The remaining volume is the graveyard.</p>
<p>Like the material definitions and boundary conditions discussed in the previous section. The graveyard is defined by assigning it a specific group name, one of the following keywords:</p>
<blockquote>
<div>graveyard
outside.world
rest.of.world</div></blockquote>
<p>Consider a geometry with 99 volumes that all fit within a cube centered at the origin with side-length 99 cm.  To create a graveyard for this problem in CUBIT, you could issue the following commands:
::
cubit_prompt&gt; create brick x 100
cubit_prompt&gt; create brick x 105
cubit_prompt&gt; subtract vol 100 from vol 101
cubit_prompt&gt; group &#8220;graveyard&#8221; add vol 102</p>
<p>When DAG-MCNP5 is run, the importance of volume 102 (or any other volumes included in the group) will be set to zero. (_Note: this assumes that the two <tt class="docutils literal"><span class="pre">create</span> <span class="pre">brick</span></tt> commands generate volumes numbered 100 and 101, respectively, and that the Boolean subtraction results in a new volume number 102.</p>
<p>If you have boundary conditions (reflecting, white, or periodic) it is not required that you surround them with the bounding volume, but is not incorrect to do so.  Only areas where particles should escape need to be enclosed.  However, it is often easiest to simply create a single graveyard that covers all directions and volumes of the system.</p>
<ul class="simple">
<li><strong>Surface boundary conditions: reflection</strong></li>
</ul>
<p>Surface boundary conditions are similarly enforced by specifying a group name. This type of attribute (surface boundary condition) is only required if reflective or white boundary conditions are used in the problem.  If not, this section may be skipped.  <em>Note that periodic boundary conditions are not yet supported.</em></p>
<p>Specifying reflecting and white boundary conditions are fairly straightforward.  The group names for reflecting and white are respectively:</p>
<blockquote>
<div>spec.reflect
white.reflect</div></blockquote>
<p>Suppose surfaces 10 and 11 are reflecting boundary conditions.  To specify these as reflecting surfaces, the following group would be created:</p>
<blockquote>
<div>group &#8220;spec.reflect&#8221; add surf 10 11</div></blockquote>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="tally-assignments">
<h2><a href="#id14"><span class="problematic" id="id15">*</span></a>:Tally Assignments<a class="headerlink" href="#tally-assignments" title="Permalink to this headline">¶</a></h2>
<p>It is also possible, although not required, to specify tallies in the geometry.  The general form for adding this meta-data is to create a group of volumes or surfaces and encode the meta-data in the names of those groups.</p>
<p>The user has the option of specifying tallies in the geometry directly.  It is still possible to specify tallies in the MCNP input file, however, the user has to make sure that the tally indices are not duplicated lest a fatal error will occur.  Tallies are specified as group names in the following format:</p>
<blockquote>
<div>tally_[CUBIT tally ID]_[tally type keyword]_[particles]</div></blockquote>
<p>The <tt class="docutils literal"><span class="pre">[CUBIT</span> <span class="pre">tally</span> <span class="pre">ID]</span></tt> field is an integer from 0 to 99.  Different tally types may have the same CUBIT ID and are still consistent.  The tally number in MCNP is 10 times the CUBIT ID plus the tally type index (e.g. 4 for cell flux tallies).</p>
<p>The <tt class="docutils literal"><span class="pre">[tally</span> <span class="pre">type</span> <span class="pre">keyword]</span></tt> is one of the following for each type of tally:</p>
<p><a href="#id32"><span class="problematic" id="id33">|Tally Type|tally type keyword|</span></a>
<a href="#id34"><span class="problematic" id="id35">|f1     |surf.current|</span></a>
<a href="#id36"><span class="problematic" id="id37">|f2     |surf.flux|</span></a>
<a href="#id38"><span class="problematic" id="id39">|f4     |cell.flux|</span></a>
<a href="#id40"><span class="problematic" id="id41">|f6     |cell.heating|</span></a>
<a href="#id42"><span class="problematic" id="id43">|f7     |cell.fission|</span></a>
<a href="#id44"><span class="problematic" id="id45">|f8     |pulse.height|</span></a></p>
<p>Also <a href="#id16"><span class="problematic" id="id17">*</span></a>tallies (the tally result times the incident particle energy) are possible by placing an &#8220;e&#8221; before the tally type.  So to make a <a href="#id18"><span class="problematic" id="id19">*</span></a>f2 tally, the keyword would be esurf_flux.  Pulse height (f8) tallies have the option to include charge as well.  This is done by placing a &#8220;q&#8221; before the keyword as in qpulse_height.</p>
<p>The <tt class="docutils literal"><span class="pre">[particles]</span></tt> tag is a string stating which particles will be tallied.  To tally both photons and neutrons, set the tag to &#8220;np&#8221;.  The default is neutrons only.  Should this be tag be omitted, only neutrons will be tallied.</p>
<p>Some CUBIT commands to do tallies:</p>
<blockquote>
<div>group &#8220;tally_0_surf.current&#8221; add surf 1 to 4
group &#8220;tally_0_cell.flux_p&#8221; add vol 7
group &#8220;tally_1_ecell.heating_np&#8221; add vol 2 6
group &#8220;tally_6_cell.heating_n&#8221; add vol 2 6
group &#8220;tally_7_cell.flux_p&#8221; add vol 1 to 3
group &#8220;tally_12_pulse.height_p&#8221; add vol 10 to 14
group &#8220;tally_14_qpulse.height_p&#8221; add vol 10 to 14</div></blockquote>
<p>The above are equivalent to following MCNP definitions:</p>
<blockquote>
<div>f1:n 1 2 3 4 T
f4:p 7 T
<a href="#id20"><span class="problematic" id="id21">*</span></a>f16:n,p 2 6 T
f66:n 2 6 T
f74:p 1 2 3 T
f128:p 10 11 12 13 14 T
+f148:p 10 11 12 13 14 T</div></blockquote>
<p><em>(Note: the current convention is to always add a tally bin for the total across all cells/volumes.)</em></p>
<p>In addition to many other MCNP5 data cards, it is important to define the materials that have been assigned in step 2.D.i.a above and any tally modifiers, as desired, for the tallies defined in step 2.D.i.a above.</p>
<p>A new data card has been added to DAG-MCNP5 to define parameters for the DAGMC geometry capability.  These parameters are <a class="reference external" href="#S2C">described conceptually above</a>.</p>
<p>::
Form: dagmc  keyword1=value   keyword2=value</p>
<blockquote>
<div><p>Keywords: check_src_cell usecad distlimit overlap_thickness</p>
<dl class="docutils">
<dt>overlap_thickness `` allows particle tracking through small overlaps</dt>
<dd>{real} [default``0.0]</dd>
<dt>check_src_cell    `` behavior of CEL variable in SDEF card</dt>
<dd>on  [default] standard interpretation for CEL variable: source rejection
off           no cell rejection - assume that sampled position is in cell CEL</dd>
<dt>usecad            `` toggle usage of solid model geometry</dt>
<dd>off [default] ray-tracing limited to facets
on            ray-tracing performed on solid model geometry surfaces</dd>
<dt>distlimit         `` toggle usage of flight distance sampled from physics</dt>
<dd>to accelerate ray-tracing search
off [default] do not use physics flight distance
on            do use physics flight distance</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt><a href="#id22"><span class="problematic" id="id23">``</span></a>gcad=&lt;geom_file&gt;=</dt>
<dd>(required) The <tt class="docutils literal"><span class="pre">geom_file</span></tt> is the geometry file that contains your geometric model, either in the ACIS (<em>.sat) format or the MOAB (</em>.h5m) format.  If this entry is not present, DAG-MCNP5 will assume that it is running in standard MCNP5 mode.  This runtime parameter is described in more detail above.</dd>
<dt><a href="#id24"><span class="problematic" id="id25">``</span></a>ftol``&lt;faceting_tolerance&gt;=</dt>
<dd>(optional) [default: 1e-3] This is a real number that provides guidance to the faceting engine regarding the maximum distance between a facet and the surface it is representing.  It is only used when reading an ACIS (<em>.sat) ``geom_file``.  When reading a MOAB (</em>.h5m) file, the facets have already been generated and this setting is ignored.  This runtime parameter is described in more detail above.</dd>
<dt><a href="#id26"><span class="problematic" id="id27">``</span></a>fcad``&lt;facet_file&gt;</dt>
<dd>(optional) The <tt class="docutils literal"><span class="pre">facet_file</span></tt> is written by DAG-MCNP5 in the MOAB (<a href="#id28"><span class="problematic" id="id29">*</span></a>.h5m) format.  When an ACIS file is read by DAG-MCNP5, a number of pre-processing and initialization steps are necessary.  Since these can be time consuming, the user has the option to create a <tt class="docutils literal"><span class="pre">facet_file</span></tt> the first time that they use a geometry and then use that <tt class="docutils literal"><span class="pre">facet_file</span></tt> with the <tt class="docutils literal"><span class="pre">gcad</span></tt> keyword in subsequent uses.  This runtime parameter is described in more detail above.</dd>
<dt><a href="#id30"><span class="problematic" id="id31">``</span></a>lcad``&lt;log_file&gt;=</dt>
<dd>(optional) The <tt class="docutils literal"><span class="pre">log_file</span></tt> is a skeleton of an MCNP file for the cells and surfaces in your geometry.  This file is created by DAG-MCNP5 to communicate the material assignments, boundary conditions, and tallies that you defined in your geometry.  If you give a name other than the default (=lcad=) for this file on the command-line, that file will be used instead of the one generated automatically by DAG-MCNP5.  This is useful to make small changes to your material assignments and/or importances, but <strong>can not</strong> be used to change the geometry.  It is up to the user to ensure that the <tt class="docutils literal"><span class="pre">log_file</span></tt> being used corresponds to the geometry file in question.  This runtime parameter is unique to the DAG-MCNP5 implementation of DAGMC.</dd>
</dl>
<blockquote>
<div>2.D.ii.a. Geometry Metadata</div></blockquote>
<blockquote>
<div>Assigning Materials &amp; Densities</div></blockquote>
<blockquote>
<div>comp_[compname]</div></blockquote>
<p><tt class="docutils literal"><span class="pre">[compname]</span></tt> is replaced by the composition name that will be specified in the Tripoli4 input file.  <tt class="docutils literal"><span class="pre">[density]</span></tt> is replaced by either the atomic density or the mass density.  Like the MCNP cell cards, positive values are atomic densities in [atoms/barn-cm] and negative values are mass densities in [g/cc].</p>
<p>For example, suppose UO2 is composition <tt class="docutils literal"><span class="pre">Uoxide</span></tt> in the problem and volumes 4 through 18 consist of this material.  To assign materials to these volumes, the following command would be used:</p>
<blockquote>
<div>group &#8220;comp_Uoxide&#8221; add vol 4 to 18</div></blockquote>
<p><em>Note: If a volume is not assigned to a specific group, when run in DAGMC it will be treated as a void; the material for that cell will be zero. This can actually become a fairly useful debugging tool to identify volumes that were not assigned to their appropriate group.</em></p>
<p>If you would like to assign a material to the explicit complement, you can use the same mechanism, but add the string <tt class="docutils literal"><span class="pre">_comp</span></tt> to the end of the group name.  Since DAGMC only recognizes those groups that contain an entity, it is necessary to add a volume to this group, recognizing that this material will NOT be assigned to that volume.  (_It is often convenient to assign the graveyard volume (see below) to the implicit complement material group to minimize confusion._)  For example, if you would like the explicit complement to be modeled with the composition named &#8220;air&#8221;:</p>
<blockquote>
<div><p>create group &#8220;comp_air_comp&#8221;</p>
<blockquote>
<div>Defining Boundary Conditions</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><strong>Defining the &#8220;graveyard&#8221;: vacuum boundaries</strong></li>
</ul>
<p>A vacuum boundary condition is typically defined in Tripoli4 by simply having a surface with not defined volume on its other side.  Since DAGMC&#8217;s implicit complement is also defined this way, it is not possible to use this convention in DAG-Tripoli4.  Instead, volumes are created on the vacuum side of those same surfaces, but those volumes are placed in a special group, known as the &#8220;graveyard&#8221; to change their behavior.  Any geometric shape can be used for this; however, a cubic shell is often preferred.  This shell volume will represent the outside world and will be the cell where all of the particles are terminated (thus it will have an importance of zero).</p>
<p>[need more on implicit complement in context of Tripoli]</p>
<p>To create this volume create two volumes in CUBIT with the same shape, same center, and one slightly larger than the other.  Subtract the smaller from the larger.  The remaining volume is the graveyard.</p>
<p>Like the material definitions and boundary conditions discussed in the previous section. The graveyard is defined by assigning it a specific group name, one of the following keywords:</p>
<blockquote>
<div>graveyard
outside.world
rest.of.world</div></blockquote>
<p>Consider a geometry with 99 volumes that all fit within a cube centered at the origin with side-length 99 cm.  To create a graveyard for this problem in CUBIT, you could issue the following commands:
::
cubit_prompt&gt; create brick x 100
cubit_prompt&gt; create brick x 105
cubit_prompt&gt; subtract vol 100 from vol 101
cubit_prompt&gt; group &#8220;graveyard&#8221; add vol 102</p>
<p>When DAG-Tripoli4 is run, the surfaces of volume 102 (or any other volumes included in the group) will be defined as having only one volume - the one on the OTHER SIDE relative to voluem 102. (_Note: this assumes that the two <tt class="docutils literal"><span class="pre">create</span> <span class="pre">brick</span></tt> commands generate volumes numbered 100 and 101, respectively, and that the Boolean subtraction results in a new volume number 102.</p>
<p>If you have boundary conditions (reflecting, white, or periodic) it is not required that you surround them with the bounding volume, but is not incorrect to do so.  Only areas where particles should escape need to be enclosed.  However, it is often easiest to simply create a single graveyard that covers all directions and volumes of the system.</p>
<ul class="simple">
<li><strong>Surface boundary conditions: reflection</strong></li>
</ul>
<p>Surface boundary conditions are similarly enforced by specifying a group name. This type of attribute (surface boundary condition) is only required if reflective or white boundary conditions are used in the problem.  If not, this section may be skipped.  <em>Note that periodic boundary conditions are not yet supported.</em></p>
<p>Specifying reflecting and white boundary conditions are fairly straightforward.  The group names for reflecting and white are respectively:</p>
<blockquote>
<div>spec.reflect
white.reflect</div></blockquote>
<p>Suppose surfaces 10 and 11 are reflecting boundary conditions.  To specify these as reflecting surfaces, the following group would be created:</p>
<blockquote>
<div>group &#8220;spec.reflect&#8221; add surf 10 11</div></blockquote>
<p>::
&lt;geometry_filename&gt;  This must be the first parameter
facet_tol &lt;double faceting tolerance&gt; (optional: default=0.001)
facet_file &lt;string faceting filename&gt; (optional)
check_src_cell &lt;&#8221;off&#8221;|&#8221;false&#8221;|&#8221;no&#8221;&gt; (optional: default=on)
usecad &lt;&#8221;on&#8221;|&#8221;true&#8221;|&#8221;yes&#8221;&gt; (optional: default=off)
distlimit &lt;&#8221;on&#8221;|&#8221;true&#8221;|&#8221;yes&#8221;&gt; (optional: default=off)
tolerance &lt;double ray firing tolerance&gt; (optional: default=1e-8)</p>
<p>These parameters are <a class="reference external" href="#S2C">defined in more detail above</a>.  In addition to many other Tripoli input blocks, it is important to define the material compositions that have been assigned in step 2.D.ii.a.</p>
<p><a class="reference external" href="#Q2">Q2. Can I automate the CUBIT conversion process?</a></p>
<hr class="docutils" />
<p>&#8212;&#8212;&#8211;<em>How does the implicit complement work?</em></p>
<p><strong>A1</strong> Since your geometry has been imprinted and merged, all surfaces fall into one of two categories:
1. surfaces that are shared by two volumes
2. surfaces that are used in only one volume</p>
<p>All surfaces in this second group are, by definition, on the boundary of the complement region since they have an explicitly defined region on one side and nothing on the other.  The implicit complement is formed automatically from this list of surfaces.</p>
<p>From the point of view of MCNP, and extra cell is created to represent the implicit complement.  Your output file will include one entry for each volume in your geometry, including the graveyard, plus one extra entry representing the complement.</p>
<p>&#8212;&#8212;&#8211;<em>The CUBIT conversion process is tedious and frustrating. Is there a way to avoid or automate most of this work?</em></p>
<p><strong>A2</strong> Yes, a script has been written that will automate all the necessary steps to perform the CUBIT conversion process with limited user input. Information about this script can be found on the AutomatedCubitConversion website.</p>
<ul class="simple">
<li>Visualization of geometry in VisIt</li>
<li>Visualization of mesh tallies in VisIt</li>
<li>Converting MCNP geometry to CAD</li>
<li>Automated CUBIT conversion script (AutomatedCubitConversion)</li>
</ul>
<p>_[ HomePage - CnergSoftware - DirectAcceleratedGeometryMonteCarlo ]_</p>
</div>
</div>


          </div>
      </div>

    </div>
</div>
    <div id="footer">
      <p>
        &copy; Copyright 2012, The UW CNERG Team.
      </p>
      <p>
      Last updated on Sep 02, 2012.
      </p>
      <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
      </p>
    </div>
  </body>
</html>