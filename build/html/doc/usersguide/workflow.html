

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using DAGMC - The DAGMC Workflow &mdash; DAGMC</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="DAGMC" href="../../index.html" />
    <link rel="up" title="DAGMC User’s Guide" href="index.html" />
    <link rel="next" title="Monte Carlo Code-Specific Steps for DAG-MCNP5" href="dag-mcnp5.html" />
    <link rel="prev" title="Getting and Installing the DAGMC Toolkit" href="get_install.html" /> 
  </head>
  <body> 
<div id="page-div" class="page">
<div id="header"><a id="uwhome" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/wordmark.gif" alt="University of Wisconsin–Madison" width="260" height="11" /></a> <a id="crest" href="http://www.wisc.edu"><img src="/DAGMC/_static/images/crest.png" alt="" width="70" height="106" /></a>
    <h1 id="siteTitle"><a href="/"><span>DAGMC</span></a></h1>
    <div id="tagline"><span>Direct Accelerated Geometry Monte Carlo Toolkit</span></div>
    <ul id="globalnav">
      <li id="uwsearch"><a href="http://www.wisc.edu/search/">UW Search</a></li>
      <li><a href="http://cnerg.github.com">CNERG</a></li>
      <li><a href="http://my.wisc.edu">My UW</a></li>
      <li><a href="http://map.wisc.edu">Map</a></li>
      <li id="last_tool"><a href="http://www.today.wisc.edu">Calendar</a></li>
    </ul>
    <form role="search" action="../../search.html" method="get" id="cse-search-box">
      <div>
      <label class="screen-reader-text" for="q">Search for:</label>
      <input type="text" id="q" name="q" value="Enter keywords here...." />
      <input type="submit" id="sa" value="Search" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
      </div>
    </form>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

    <div id="nav" class="main-menu-container">
      <ul id="menu-main" class="sf-menu">
        <li class="menu-item"><a href="../../index.html">DAGMC</a></li>
        <li class="menu-item" style="margin-right: 10px">
          <a href="get_install.html" title="Getting and Installing the DAGMC Toolkit"
             accesskey="P">previous</a>
          </li>
        <li class="menu-item" >
          <a href="dag-mcnp5.html" title="Monte Carlo Code-Specific Steps for DAG-MCNP5"
             accesskey="N">next</a>
          </li>
        <li class="menu-item" >
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a>
          </li>
          <li class="menu-item"><a href="index.html" accesskey="U">DAGMC User&#8217;s Guide</a></li> 
      </ul>
    </div>
  <div id="c_container"> 
<div id="sidebar">
 <div id="sidebar_section"></div>
 <div id="sidebar_section"><strong>Table of Contents</strong><br><ul>
<li><a class="reference internal" href="#">Using DAGMC - The DAGMC Workflow</a><ul>
<li><a class="reference internal" href="#preparing-solid-models">Preparing Solid Models</a><ul>
<li><a class="reference internal" href="#knowing-the-model">Knowing the model</a></li>
<li><a class="reference internal" href="#identifying-weaknesses-in-the-model">Identifying weaknesses in the model</a></li>
<li><a class="reference internal" href="#modifying-your-model">Modifying your model</a></li>
<li><a class="reference internal" href="#assessing-your-model">Assessing your model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pre-processing-solid-models-using-cubit">Pre-processing Solid Models using CUBIT</a><ul>
<li><a class="reference internal" href="#importing-the-solid-model">Importing the Solid Model</a></li>
<li><a class="reference internal" href="#imprint-and-merge">Imprint and Merge</a></li>
<li><a class="reference internal" href="#grouping-volumes-and-surfaces">Grouping Volumes and Surfaces</a></li>
<li><a class="reference internal" href="#finishing-up-and-final-notes">Finishing Up and Final Notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-input-parameters-for-dagmc">Additional Input Parameters for DAGMC</a><ul>
<li><a class="reference internal" href="#geometry-file-basic">Geometry File (basic)</a></li>
<li><a class="reference internal" href="#faceting-tolerance-basic">Faceting Tolerance (basic)</a></li>
<li><a class="reference internal" href="#facet-file-basic">Facet File (basic)</a></li>
<li><a class="reference internal" href="#overlap-thickness-advanced">Overlap Thickness (advanced)</a></li>
<li><a class="reference internal" href="#source-cell-treatment-intermediate">Source Cell Treatment (intermediate)</a></li>
<li><a class="reference internal" href="#use-cad-geometry-advanced">Use CAD geometry (advanced)</a></li>
<li><a class="reference internal" href="#use-distance-limit-experimental">Use Distance Limit (experimental)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
 </div>
</div> 
    <div id="content" class="inline-block">
          <div class="post">
            
  <div class="section" id="using-dagmc-the-dagmc-workflow">
<h1>Using DAGMC - The DAGMC Workflow<a class="headerlink" href="#using-dagmc-the-dagmc-workflow" title="Permalink to this headline">¶</a></h1>
<p>The following steps are necessary to perform an analysis with most
DAGMC versions of Monte Carlo radiation transport codes. (see below
for more details on each step)</p>
<ol class="arabic">
<li><p class="first">create and/or prepare a solid model using the CAD/solid-modeling tool of your choice</p>
</li>
<li><dl class="first docutils">
<dt>pre-processing of the solid model geometry in CUBIT</dt>
<dd><ul class="first last simple">
<li>assign materials and densities</li>
<li>define boundary conditions</li>
<li>imprint &amp; merge geometry</li>
<li>export that model in the ACIS format</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">prepare native MC code input file
* understanding additional <tt class="docutils literal"><span class="pre">dagmc</span></tt> parameters</p>
</li>
<li><p class="first">Run MC code, possibly with additional command line parameters</p>
</li>
</ol>
<div class="section" id="preparing-solid-models">
<h2>Preparing Solid Models<a class="headerlink" href="#preparing-solid-models" title="Permalink to this headline">¶</a></h2>
<p>In theory, solid models can be prepared in any modeling software
system (e.g. SolidWorks, Pro/E, Catia, etc).  What is most important
about the choice of solid modeling system is the ability to export to
a format that can be imported by CUBIT, in particular:</p>
<ul class="simple">
<li>ACIS (<a href="#id1"><span class="problematic" id="id2">*</span></a>.sat)</li>
<li>STEP (<a href="#id3"><span class="problematic" id="id4">*</span></a>.stp, <a href="#id5"><span class="problematic" id="id6">*</span></a>.STEP, etc)</li>
</ul>
<p>There are a number of concepts to consider while preparing a solid
model; however, the most important considerations are small gaps and
overlaps that might exist in the model. These gaps and overlaps can
lead to rapid failure when running a DAGMC-based analysis. The
following steps are provided to help make a more robust model <em>before</em>
running your DAGMC-based analysis.</p>
<p>Be aware: obtaining a robust model may be an iterative and time
consuming process. In some cases, the validity of the model will
require running a DAGMC-based analysis and assessing whether or not
the model yielded expected results or a small enough number of lost
particles. If the results did not meet expectations, changes to the
model may be in order.</p>
<div class="section" id="knowing-the-model">
<h3>Knowing the model<a class="headerlink" href="#knowing-the-model" title="Permalink to this headline">¶</a></h3>
<p>The first consideration to address is where the solid model originated
and for what purpose. In many instances, models constructed for
manufacturing purposes will have tolerances that are undesirable for
particle transport applications. For example, a gap might exist
between fuel pellets and the cladding wall for a PWR fuel rod. While
this is perfectly acceptable for an individual manufacturing the rod,
the gap could potentially cause present problems in a DAGMC-based
analysis, depending on how it is modeled.</p>
<p>Knowing who created the model and to what purpose provides a starting
point for preparing the model. If it was made with particle transport
in mind, then very little work may be needed; but as with the example
above, some models may require changes to accommodate the needs of a
DAGMC-based analysis.</p>
</div>
<div class="section" id="identifying-weaknesses-in-the-model">
<h3>Identifying weaknesses in the model<a class="headerlink" href="#identifying-weaknesses-in-the-model" title="Permalink to this headline">¶</a></h3>
<p>When assessing a model that is to be used for particle transport two
primary concerns must addressed. These concerns are:</p>
<blockquote>
<div><ul class="simple">
<li>Gaps</li>
<li>Overlaps</li>
</ul>
</div></blockquote>
<p>Gaps occur when the surfaces of two volumes/parts that should be in
contact are set apart from each instead of having coincident
surfaces. The size of the gap is generally unimportant, for most solid
modeling programs, a gap is a gap. The desired result is to have all
surfaces of volumes/parts to be coincident. If coincidence is not
achieved, particles may become lost when entering the region between
the surfaces.</p>
<p>Overlaps are found where two or more volumes/parts encroach upon the
same space. As with gaps, the magnitude of the overlapping volume is
usually unimportant.  When a particle enters a region of overlap, it
may not correctly determine which volume/part it resides in. If this
occurs, the particle may become lost.</p>
<p>Identifying gaps and overlaps may be difficult and time consuming;
however, some 3D modeling programs like SolidWorks have built in tools
to identify these occurrences. Rely on the modeling program to
identify these errors (the gaps and overlaps) and use the steps in the
next section to change, reduce and remove their effect on the model.</p>
</div>
<div class="section" id="modifying-your-model">
<h3>Modifying your model<a class="headerlink" href="#modifying-your-model" title="Permalink to this headline">¶</a></h3>
<p>Once the gaps and overlaps in the model have been identified, the
three following methods may be used to change, reduce and remove their
effect on the model.</p>
<ul class="simple">
<li>Create &#8220;voided&#8221; geometries</li>
<li>Modify volume/part dimensions</li>
<li>Remove superfluous details</li>
</ul>
<p>Each method is discussed in detail below:</p>
<p>As with the fuel rod example mentioned above, some geometries that are
&#8216;gaps&#8217; are also important. Instead of removing the gap entirely (by
changing the dimensions of the cladding or the fuel to force
coincidence), a new volume/part could be modeled that coincided with
the outer diameter of the fuel AND the inner diameter of the
cladding. Now a &#8220;voided&#8221; geometry occupies the previously unaccounted
for region. By specifying these &#8220;voided&#8221; geometries in a DAGMC-based
analysis, the physical importance of the region can be retained while
accomodating the requirement of having coincident surfaces.</p>
<p>Another method to resolve gaps and overlaps is to simply change the
dimensions of the volume/part (eg: making a dimension several cm
bigger or smaller to ensure coincidence surfaces). In many instances
this method could compromise the physics of the solution and is then
undesirable. However, in other instances, this solution is very
logical. One particularly significant example is if different volumes
were modeled with different unit systems. For example, one volume/part
might have been model in [in] while its neighbor was modeled in [cm];
while the surfaces may be nearly coincidence, rounding errors might
prevent coincidence from occurring. A simple change to one dimension
may hardly change the volume/part&#8217;s characteristics yet result in
coincidence.</p>
<p>Finally, superfluous details may prevent a volume/part from coinciding
with its neighbors properly. A potential solution is to simply remove
the superfluous detail to simplfy the model and ensure the desired
surfaces are coincident. Some volumes/parts will inherently hurt the
model&#8217;s effectiveness either due to its complex features or small
dimensions. A volume/part&#8217;s effect on the model cannot truly be
assessed until a DAGMC-based analysis is run. This final method is
usually implemented in an attempt to reduce the number of lost particles
while maintaining the most important characteristics of the system.</p>
<dl class="docutils">
<dt><a href="#id7"><span class="problematic" id="id8">*</span></a>Note: Of all steps, the removal of superfluous details is the most</dt>
<dd>subjective and heavily dependent on the model&#8217;s intended
application.*</dd>
</dl>
</div>
<div class="section" id="assessing-your-model">
<h3>Assessing your model<a class="headerlink" href="#assessing-your-model" title="Permalink to this headline">¶</a></h3>
<p>Lost particles are undesirable; lost particles usually indicate
weaknesses and failures within the geometry. While the goal of the
DAGMC project is to guarantee that there will never be lost particles,
they can occur even on robust geometries.  It is up to the
user/analyst to determine what lost particle rate they consider
acceptable.  The UW-Madison group usually considers lost particle
rates that are less than 1/50,000 to be a threshold for most problems.
It is important to understand whether particles are being lost from an
important region of your phase space.</p>
<p>[Insert note on the implicit complement here]</p>
</div>
</div>
<div class="section" id="pre-processing-solid-models-using-cubit">
<h2>Pre-processing Solid Models using CUBIT<a class="headerlink" href="#pre-processing-solid-models-using-cubit" title="Permalink to this headline">¶</a></h2>
<p><em>Note: For large models, the steps described below can be very tedious
and time consuming.  To accelerate the process, an automated approach
is available for models that have been properly prepared in the native
solid modeling software.  This AutomatedCubitConversion process is
described elsewhere, but reading the information below will provided
the knowledge-base needed to understand the automation process.</em></p>
<p>This section focuses on steps that are independent of the MC code used
for analysis.  Additional steps for <a class="reference external" href="#S2Di">DAG-MCNP5</a> and
<a class="reference external" href="#S2Dii">DAG-Tripoli4</a> may be based on the instructions given here,
but are provided in separate parts of section 2.D below.</p>
<div class="section" id="importing-the-solid-model">
<h3>Importing the Solid Model<a class="headerlink" href="#importing-the-solid-model" title="Permalink to this headline">¶</a></h3>
<p>The first step in CUBIT is to import the generated solid
model. Depending on the complexity of the model, this step can take
several seconds up to a half an hour. As an initial user, it is
recommend to start with simple models and geometries to obtain a
better understanding of CUBIT.</p>
</div>
<div class="section" id="imprint-and-merge">
<h3>Imprint and Merge<a class="headerlink" href="#imprint-and-merge" title="Permalink to this headline">¶</a></h3>
<p>For a DAGMC-based analysis to work properly, all of the surfaces must
be imprinted and merged.  Imprinting creates a common surface
interface between touching volumes.  Merging then takes the touching
surfaces and makes them into one surface.</p>
<p>To imprint, issue the following command:</p>
<div class="highlight-python"><pre>imprint body all</pre>
</div>
<p>Should the imprint be successful, then the next step is to merge the
geometry. Sometimes it may be important to specify a merge tolerance.
To set the tolerance and merge, issue the following commands:</p>
<div class="highlight-python"><pre>merge tol 5e-7
merge all</pre>
</div>
<p>This process can be very time consuming. For large models of several
thousand volumes, the imprint and merge steps can take up to three
hours. However, small geometries (on the order of 100 volumes) the
process is rather quick.</p>
</div>
<div class="section" id="grouping-volumes-and-surfaces">
<span id="grouping-basics"></span><h3>Grouping Volumes and Surfaces<a class="headerlink" href="#grouping-volumes-and-surfaces" title="Permalink to this headline">¶</a></h3>
<p>A DAGMC-based analysis allows a number of attributes of the geometry
to be defined within the geometry file. These characteristics
generally relate to the physical behavior of the volume, for example
its material definition or boundary conditions.</p>
<p>Before the discussion of specific attributes, the practice of
&#8220;grouping&#8221; needs to be explained. A group is essentially a collection
of volumes or surfaces that share a common attribute; the practical
usage of &#8220;grouping&#8221; will be explained in the next section.</p>
<p>The general format for creating/adding volumes to a group is:</p>
<div class="highlight-python"><pre>group "group.name" add vol/surf ...</pre>
</div>
<p>For example, to create a group called &#8220;moderator&#8221; containing volumes
5, 6, 7, and 10, the following command would be used:</p>
<div class="highlight-python"><pre>group "moderator" add vol 5 to 8 10</pre>
</div>
<p>Another example, shows that groups don&#8217;t have to be just contain
volumes, but can contain surfaces too. Below the group
&#8220;shield.boundary&#8221; is created with surfaces 16 and 37:</p>
<div class="highlight-python"><pre>group "shield.boundary" add surf 16 37</pre>
</div>
<p>Due to the importance of using the <tt class="docutils literal"><span class="pre">group</span></tt> command reading the CUBIT
manual section on its full usage is highly recommended.</p>
</div>
<div class="section" id="finishing-up-and-final-notes">
<h3>Finishing Up and Final Notes<a class="headerlink" href="#finishing-up-and-final-notes" title="Permalink to this headline">¶</a></h3>
<p>Before exporting, it is vital to set attributes on.  This saves the
absolute volume and surface IDs as well as any group specifications.
Failing to do this will result in fatal errors.  Make sure to type the
following:</p>
<div class="highlight-python"><pre>set attribute on</pre>
</div>
<p>Finally, export the file as an ACIS file with a .sat extension.  If
you are using a version of CUBIT newer that v12.x, be sure to set the
ACIS geometry level back to version 19:</p>
<div class="highlight-python"><pre>set geom version 1900</pre>
</div>
<p>For the remainder of this documentation, the geometry file will be
referred to as &#8220;geom.sat&#8221;. Also, as noted before, the CUBIT conversion
process can be automated as described on the follow webpage:
AutomatedCubitConversion.</p>
</div>
</div>
<div class="section" id="additional-input-parameters-for-dagmc">
<span id="additional-parameters"></span><h2>Additional Input Parameters for DAGMC<a class="headerlink" href="#additional-input-parameters-for-dagmc" title="Permalink to this headline">¶</a></h2>
<p>DAGMC introduces a number of new input variables that control the
behavior of DAGMC when it interacts with your geometry.  This section
describes the conceptual behavior of those parameters and later
sections will describe their specific implementation and syntax within
each code.</p>
<div class="section" id="geometry-file-basic">
<h3>Geometry File (basic)<a class="headerlink" href="#geometry-file-basic" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>required</li>
<li>Default: none</li>
</ul>
<p>This file contains the geometry that has been created and
pre-processed using the workflow described above.  This file can be
either an ACIS geometry (usually with a <tt class="docutils literal"><span class="pre">.sat</span></tt> file extension) or a
MOAB facet file (usually with a <tt class="docutils literal"><span class="pre">.h5m</span></tt> file extension).</p>
</div>
<div class="section" id="faceting-tolerance-basic">
<h3>Faceting Tolerance (basic)<a class="headerlink" href="#faceting-tolerance-basic" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>optional</li>
<li>Default: 0.001</li>
</ul>
<p>One of the first steps performed by DAGMC is to generate a faceted
representation of your solid model.  To ensure a faithful
representation of the model, the facets are constrained such that all
points on each facet are within a tolerance of the nearest points on
the exact surface representation.  A smaller tolerance results in a
more faithful representation of the surface at the penalty of
producing more facets.  The user can control the faceting tolerance
using when they invoke their simulation, either on the command line or
in the input file, depending on the MC code being used for the
analysis.  This option only has an effect with the geometry file is a
solid model and not when it is a facet file.</p>
</div>
<div class="section" id="facet-file-basic">
<h3>Facet File (basic)<a class="headerlink" href="#facet-file-basic" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>optional</li>
<li>Default: none</li>
</ul>
<p>For some models, the initial processing can be time consuming.  When
reading a solid model geometry, this option causes a processed file to
be written that can be used on subsequent analyses.  This file will be
processed with the facet tolerance as defined above.  This facet
tolerance cannot be changed when the file is reused.</p>
</div>
<div class="section" id="overlap-thickness-advanced">
<h3>Overlap Thickness (advanced)<a class="headerlink" href="#overlap-thickness-advanced" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>optional</li>
<li>Default: 0.0</li>
</ul>
<p>Often CAD geometry has small overlaps between adjacent volumes due to
file translation or imprecise modeling. The particle tracking
algorithm can accommodate small overlaps if the maximum thickness of
overlaps is approximately known.</p>
</div>
<div class="section" id="source-cell-treatment-intermediate">
<h3>Source Cell Treatment (intermediate)<a class="headerlink" href="#source-cell-treatment-intermediate" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>optional</li>
<li>Default: on (same behavior as native code)</li>
</ul>
<p>The implementation of this option is specific to the Monte Carlo code
being used.  Please refer to the documentation for your underlying
Monte Carlo code.</p>
</div>
<div class="section" id="use-cad-geometry-advanced">
<h3>Use CAD geometry (advanced)<a class="headerlink" href="#use-cad-geometry-advanced" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>optional</li>
<li>Default: off</li>
</ul>
<p>When this option is turned on, the ray-firing process finds the
intersection with the CAD-based solid model itself, and not just with
the faceted representation of that model.  The facet-based ray-firing
solution is used as an initial guess to solve for the point on the
actual CAD surface where the ray-surface intersection takes place.
This option is only available when the DAGMC toolkit has been linked
to the ACIS geometry libraries directly and not when it has been
linked via CUBIT.</p>
</div>
<div class="section" id="use-distance-limit-experimental">
<h3>Use Distance Limit (experimental)<a class="headerlink" href="#use-distance-limit-experimental" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>optional</li>
<li>Default: off</li>
</ul>
<p>This option allows a previously determined distance to the next
collision to be used to accelerate the search for ray-surface
intersections.  Any candidate ray-surface intersection that is at a
distance beyond the known distance to collision will be rejected,
including bounding box tests in the OBB tree search.</p>
</div>
</div>
</div>


          </div>
      </div>

    </div>
</div>
    <div id="footer">
      <p>
        &copy; Copyright 2012-2013, The UW CNERG Team.
      </p>
      <p>
      Last updated on Aug 11, 2013.
      </p>
      <p>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
      </p>
    </div>
  </body>
</html>